[[release-notes-6.6.2]]
== {es} version 6.6.2

Also see <<breaking-changes-6.6, Breaking changes in 6.6>>.

[[breaking-6.6.2]]
[float]
=== Breaking changes

Authentication::
* Disable BWC mode in TokenService by default {es-pull}38881[#38881]

[[enhancement-6.6.2]]
[float]
=== Enhancements

SQL::
* Enhance checks for inexact fields {es-pull}39427[#39427] (issue: {es-issue}38501[#38501])
* Add "validate.properties" property to JDBC's allowed list of settings {es-pull}39050[#39050] (issue: {es-issue}38068[#38068])

[[bug-6.6.2]]
[float]
=== Bug fixes

Authentication::
* Use consistent view of realms for authentication {es-pull}38815[#38815] (issue: {es-issue}30301[#30301])

Engine::
* Bubble up exception when processing NoOp {es-pull}39338[#39338] (issue: {es-issue}38898[#38898])
* Advance max_seq_no before add operation to Lucene {es-pull}38879[#38879] (issue: {es-issue}31629[#31629])

Machine Learning::
* Stop the ML memory tracker before closing nodes {es-pull}39111[#39111] (issue: {es-issue}37117[#37117])
* Fix an issue where interim results would be calculated after advancing time
into an empty bucket {ml-pull}416[#416] (issue: {ml-issue}324[#324])

SQL::
* Fix merging of incompatible multi-fields {es-pull}39560[#39560] (issue: {es-issue}39547[#39547])
* Ignore UNSUPPORTED fields for JDBC and ODBC modes in 'SYS COLUMNS' {es-pull}39518[#39518] (issue: {es-issue}39471[#39471])
* Use underlying exact field for LIKE/RLIKE {es-pull}39443[#39443] (issue: {es-issue}39442[#39442])
* Enforce JDBC driver - ES server version parity {es-pull}38972[#38972] (issue: {es-issue}38775[#38775])
* Fall back to using the field name for column label {es-pull}38842[#38842] (issue: {es-issue}38831[#38831])
* Normalized keywords shouldn't be allowed for groupings and sorting [ISSUE] {es-pull}35203[#35203]

Search::
* Fix Fuzziness#asDistance(String) {es-pull}39643[#39643] (issue: {es-issue}39614[#39614])
* Fix simple query string serialization conditional {es-pull}38960[#38960] (issues: {es-issue}21504[#21504], {es-issue}38889[#38889])

Watcher::
* Only flush Watcher's bulk processor if Watcher is enabled {es-pull}38803[#38803] (issue: {es-issue}38798[#38798])

[[release-notes-6.6.1]]
== {es} version 6.6.1

Also see <<breaking-changes-6.6, Breaking changes in 6.6>>.

[[enhancement-6.6.1]]
[float]
=== Enhancements

Machine Learning::
* Add explanation so far to file structure finder exceptions {es-pull}38191[#38191]

SQL::
* Generate relevant error message when grouping functions are not used in GROUP BY {es-pull}38017[#38017] (issue: {es-issue}37952[#37952])
* Skip the nested and object field types in case of an ODBC request {es-pull}37948[#37948] (issue: {es-issue}37801[#37801])
* Describe aliases as views {es-pull}37496[#37496] (issue: {es-issue}37422[#37422])

Security::
* Cleanup construction of interceptors {es-pull}38294[#38294]

[[bug-6.6.1]]
[float]
=== Bug fixes

Audit::
* Fix IndexAuditTrail rolling upgrade on rollover edge - take 2 {es-pull}38286[#38286] (issues: {es-issue}33867[#33867], {es-issue}37062[#37062])
* Fix NPE in Logfile Audit Filter {es-pull}38120[#38120] (issue: {es-issue}38097[#38097])

Authentication::
* Enhance parsing of StatusCode in SAML Responses {es-pull}38628[#38628]
* Fix expired token message in Exception header {es-pull}37196[#37196]

CCR::
* Do not set fatal exception when shard follow task is stopped. {es-pull}37603[#37603]

Distributed::
* Fix synchronization in LocalCheckpointTracker#contains {es-pull}38755[#38755]

Geo::
* Fix GeoHash PrefixTree BWC {es-pull}38584[#38584] (issue: {es-issue}38494[#38494])
* Geo: Do not normalize the longitude with value -180 for Lucene shapes {es-pull}37299[#37299] (issue: {es-issue}37297[#37297])

ILM::
* Preserve ILM operation mode when creating new lifecycles {es-pull}38134[#38134], {es-pull}38230[#38230])

Machine Learning::
* Fix error race condition on stop _all datafeeds and close _all jobs {es-pull}38113[#38113] (issue: {es-issue}37959[#37959])
* Update ML results mappings on process start {es-pull}37706[#37706] (issue: {es-issue}37607[#37607])

Monitoring::
* Allow built-in monitoring_user role to call GET _xpack API {es-pull}38060[#38060] (issue: {es-issue}37970[#37970])

Network::
* Reload SSL context on file change for LDAP {es-pull}36937[#36937] (issues: {es-issue}30509[#30509], {es-issue}36923[#36923])

SQL::
* Prevent grouping over grouping functions {es-pull}38649[#38649] (issue: {es-issue}38308[#38308])
* Relax StackOverflow circuit breaker for constants {es-pull}38572[#38572] (issue: {es-issue}38571[#38571])
* Fix issue with IN not resolving to underlying keyword field {es-pull}38440[#38440] (issue: {es-issue}38424[#38424])
* Change the Intervals milliseconds precision to 3 digits {es-pull}38297[#38297] (issue: {es-issue}37423[#37423])
* Added SSL configuration options tests {es-pull}37875[#37875] (issue: {es-issue}37711[#37711])
* Fix casting from date to numeric type to use millis {es-pull}37869[#37869] (issue: {es-issue}37655[#37655])
* Fix object extraction from sources {es-pull}37502[#37502] (issue: {es-issue}37364[#37364])
* Fix bug regarding alias fields with dots {es-pull}37279[#37279] (issue: {es-issue}37224[#37224])
* Fix issue with complex expression as args of PERCENTILE/_RANK {es-pull}37102[#37102] (issue: {es-issue}37099[#37099])

Search::
* Use executor `SAME` to handle search related handlers {es-pull}37427[#37427] (issues: {es-issue}33732[#33732], {es-issue}37392[#37392])

Security::
* Fix an improper permission issue when a new name is attached to an index. (CVE-2019-7611). See
https://www.elastic.co/community/security[Security issues].
* Fix potential NPE in UsersTool {es-pull}37660[#37660]

ZenDiscovery::
* Always return metadata version if metadata is requested {es-pull}37674[#37674]

[[release-notes-6.6.0]]
== {es} version 6.6.0

Also see <<breaking-changes-6.6,Breaking changes in 6.6.>>.

[[breaking-6.6.0]]
[float]
=== Breaking changes

Cross-cluster replication::
* Change get autofollow patterns API response format {es-pull}36203[#36203] (issue: {es-issue}36049[#36049])

Ranking::
* Forbid negative scores in function_score query {es-pull}35709[#35709] (issue: {es-issue}33309[#33309])

Search::
* Remove the distinction between query and filter context in QueryBuilders {es-pull}35354[#35354] (issue: {es-issue}35293[#35293])
* Throw a parsing exception when boost is set in span_or query (#28390) {es-pull}34112[#34112] (issue: {es-issue}28390[#28390])

Watcher::
* Fix metric stats names {es-pull}34951[#34951] (issue: {es-issue}34865[#34865])

[[breaking-java-6.6.0]]
[float]
=== Breaking Java changes

Infra/Core::
* Drop settings member from AbstractComponent {es-pull}35083[#35083]

Infra/Logging::
* Drop last deprecated logger function {es-pull}35082[#35082] (issue: {es-issue}32174[#32174])

Java High Level REST Client::
* HLRC XPack Protocol clean up: Migration; Graph; Watcher {es-pull}34639[#34639] (issue: {es-issue}34451[#34451])

ZenDiscovery::
* Make node field in JoinRequest private {es-pull}36405[#36405]

[[deprecation-6.6.0]]
[float]
=== Deprecations

Aggregations::
* Deprecate dots in aggregation names {es-pull}31468[#31468] (issues: {es-issue}17600[#17600], {es-issue}19040[#19040])

Core::
* Deprecate use of scientific notation in epoch time parsing {es-pull}36691[#36691]
* Add backcompat for joda time formats {es-pull}36531[#36531]

Features::
* Deprecation info API: 'fix' value for index.shard.check_on_startup {es-pull}36458[#36458] (issues: {es-issue}33194[#33194], {es-issue}36024[#36024])
* Deprecation info API: negative index.unassigned.node_left.delayed_timeout {es-pull}36454[#36454] (issues: {es-issue}26828[#26828], {es-issue}36024[#36024])

Mapping::
* Add warning about upcoming expanded fields limit {es-pull}34906[#34906] (issue: {es-issue}26541[#26541])

Scripting::
* Adds deprecation logging to ScriptDocValues#getValues. {es-pull}34279[#34279] (issue: {es-issue}22919[#22919])

Search::
* Warn in multi-search on unknown keys in meatdata {es-pull}36104[#36104] (issue: {es-issue}35938[#35938])
* Deprecate the _termvector endpoint. {es-pull}36098[#36098] (issue: {es-issue}8484[#8484])
* Deprecate `_source_include` and `_source_exclude` url parameters {es-pull}33475[#33475] (issue: {es-issue}22792[#22792])

Security::
* Undeprecate /_license endpoints {es-pull}35974[#35974] (issue: {es-issue}35959[#35959])

Settings::
* Deprecate setting index.optimize_auto_generated_id in 6.x {es-pull}28862[#28862] (issue: {es-issue}27600[#27600])

Watcher::
* Watcher deprecate notification service settings {es-pull}36403[#36403]
* Undeprecate /_watcher endpoints {es-pull}36269[#36269]

[[feature-6.6.0]]
[float]
=== New features

Aggregations::
* Median absolute deviation agg {es-pull}34482[#34482] (issue: {es-issue}26681[#26681])

Analysis::
* Add support for inlined user dictionary in Nori {es-pull}36123[#36123] (issue: {es-issue}35842[#35842])
* Add a prebuilt ICU Analyzer {es-pull}34958[#34958] (issue: {es-issue}34285[#34285])

Index Lifecycle Management::
* Adds Index lifecycle feature {es-pull}35193[#35193]

Java High Level REST Client::
* Add rollup search {es-pull}36334[#36334] (issue: {es-issue}29827[#29827])

Java Low Level REST Client::
* Make warning behavior pluggable per request {es-pull}36345[#36345]
* Add PreferHasAttributeNodeSelector {es-pull}36005[#36005]

Geo::
* Fork Lucene's LatLonShape Classes to local lucene package {es-pull}36794[#36794]
* Integrate Lucene's LatLonShape (BKD Backed GeoShapes) as default `geo_shape` indexing approach {es-pull}35320[#35320] (issue: {es-issue}32039[#32039])

Machine learning::
* Store job configuration information in the new `.ml-config` index {es-pull}36698[#36698] (issue: {es-issue}32905[#32905])
* Determine when data is missing from a bucket due to ingest latency {es-pull}35387[#35387] (issue: {es-issue}35131[#35131])

Search::
* Added soft limit to open scroll contexts #25244 {es-pull}36009[#36009] (issue: {es-issue}25244[#25244])
* Make lucene's IntervalQuery available via the Query DSL {es-pull}32406[#32406] (issue: {es-issue}29636[#29636])

SQL::
* Introduce HISTOGRAM grouping function {es-pull}36510[#36510] (issue: {es-issue}36509[#36509])
* DATABASE() and USER() system functions {es-pull}35946[#35946] (issue: {es-issue}35863[#35863])
* Introduce INTERVAL support   {es-pull}35521[#35521] (issue: {es-issue}29990[#29990])

[[enhancement-6.6.0]]
[float]
=== Enhancements

Aggregations::
* Enforce max_buckets limit only in the final reduction phase {es-pull}36152[#36152] (issues: {es-issue}32125[#32125], {es-issue}35921[#35921])
* Histogram aggs: add empty buckets only in the final reduce step {es-pull}35921[#35921]
* Handles exists query in composite aggs {es-pull}35758[#35758]
* Added parent validation for auto date histogram {es-pull}35670[#35670]
* Allow unmapped fields in composite aggregations {es-pull}35331[#35331] (issue: {es-issue}35317[#35317])
* Refactor children aggregator into a generic ParentJoinAggregator {es-pull}34845[#34845] (issue: {es-issue}34210[#34210])
* Add parent-aggregation to parent-join module {es-pull}34210[#34210] (issue: {es-issue}9705[#9705])

Analysis::
* Ensure TokenFilters only produce single tokens when parsing synonyms {es-pull}34331[#34331] (issue: {es-issue}34298[#34298])

Audit::
* Add "request.id" to file audit logs  {es-pull}35536[#35536]

Authentication::
* Invalidate Token API enhancements - HLRC {es-pull}36362[#36362]
* Add DEBUG/TRACE logs for LDAP bind {es-pull}36028[#36028]
* Add Tests for findSamlRealm {es-pull}35905[#35905]
* Add realm information for Authenticate API {es-pull}35648[#35648]
* Formal support for "password_hash" in Put User {es-pull}35242[#35242] (issue: {es-issue}34729[#34729])
* Enhance Invalidate Token API {es-pull}35388[#35388] (issues: {es-issue}34556[#34556], {es-issue}35115[#35115])

Authorization::
* Add origin_address to authentication_success {es-pull}36409[#36409]
* Improve exact index matching performance {es-pull}36017[#36017]
* `manage_token` privilege for `kibana_system` {es-pull}35751[#35751]
* Grant .tasks access to kibana_system role {es-pull}35573[#35573]
* Native roles store uses mget to retrieve roles {es-pull}33531[#33531] (issue: {es-issue}33205[#33205])

Build::
* Sounds like typo in exception message {es-pull}35458[#35458]
* Improve validation of yaml suites {es-pull}34957[#34957] (issue: {es-issue}34735[#34735])
* Enforce skip headers when needed {es-pull}34735[#34735] (issue: {es-issue}34650[#34650])
* Improve validation of do sections {es-pull}34734[#34734] (issue: {es-issue}34651[#34651])

Core::
* Override the JVM DNS cache policy {es-pull}36570[#36570]
* Added wait_for_metadata_version parameter to cluster state api. {es-pull}35535[#35535]
* Extract RunOnce into a dedicated class {es-pull}35489[#35489]

Cross-cluster replication::
* Add time since last auto follow fetch to auto follow stats {es-pull}36542[#36542] (issues: {es-issue}33007[#33007], {es-issue}35895[#35895])
* Clean followed leader index UUIDs in auto follow metadata {es-pull}36408[#36408] (issue: {es-issue}33007[#33007])
* Change AutofollowCoordinator to use wait_for_metadata_version {es-pull}36264[#36264] (issues: {es-issue}33007[#33007], {es-issue}35895[#35895])
* Refactor AutoFollowCoordinator to track leader indices per remote cluster {es-pull}36031[#36031] (issues: {es-issue}33007[#33007], {es-issue}35895[#35895])
* Refactor auto follow coordinator {es-pull}35895[#35895] (issue: {es-issue}33007[#33007])

CRUD::
* Document Seq No powered optimistic concurrency control {es-pull}37284[#37284] (issues: {es-issue}10708[#10708], {es-issue}36148[#36148])
* Rename seq# powered optimistic concurrency control parameters to ifSeqNo/ifPrimaryTerm  {es-pull}36757[#36757] (issues: {es-issue}10708[#10708], {es-issue}36148[#36148])
* Expose Sequence Number based Optimistic Concurrency Control in the rest layer {es-pull}36721[#36721] (issues: {es-issue}10708[#10708], {es-issue}36148[#36148])
* Add doc's sequence number + primary term to GetResult and use it for updates {es-pull}36680[#36680] (issues: {es-issue}10708[#10708], {es-issue}36148[#36148])
* Add seq no powered optimistic locking support to the index and delete transport actions {es-pull}36619[#36619] (issues: {es-issue}10708[#10708], {es-issue}36148[#36148])

Distributed::
* Allow asynchronous block operations to be delayed in IndexShardOperationPermits {es-pull}35999[#35999] (issues: {es-issue}35540[#35540], {es-issue}35850[#35850])
* TransportResyncReplicationAction should not honour blocks {es-pull}35795[#35795] (issues: {es-issue}35332[#35332], {es-issue}35597[#35597])
* Add global and index level blocks to IndexSettings {es-pull}35695[#35695] (issues: {es-issue}35332[#35332], {es-issue}35597[#35597])
* Expose all permits acquisition in IndexShard and TransportReplicationAction {es-pull}35540[#35540] (issue: {es-issue}33888[#33888])
* Add a java level freeze/unfreeze API {es-pull}35353[#35353] (issues: {es-issue}34352[#34352], {es-issue}34357[#34357])
* Check blocks while having index shard permit in TransportReplicationAction {es-pull}35332[#35332] (issue: {es-issue}33888[#33888])
* Apply masterNodeTimeout to MasterNodeRequest transmission {es-pull}35235[#35235]

Engine::
* Add sequence numbers based optimistic concurrency control support to Engine {es-pull}36467[#36467] (issues: {es-issue}10708[#10708], {es-issue}36148[#36148])
* Require soft-deletes when access changes snapshot {es-pull}36446[#36446]
* Use delCount of SegmentInfos to calculate numDocs {es-pull}36323[#36323]
* Always configure soft-deletes field of IndexWriterConfig {es-pull}36196[#36196] (issue: {es-issue}36141[#36141])
* Always return false from `refreshNeeded` on ReadOnlyEngine {es-pull}35837[#35837] (issue: {es-issue}35785[#35785])
* Add a `_freeze` / `_unfreeze` API {es-pull}35592[#35592] (issue: {es-issue}34352[#34352])
* Engine.newChangesSnapshot may cause unneeded refreshes if called concurrently {es-pull}35169[#35169]
* Do not alloc full buffer for small change requests {es-pull}35158[#35158]
* Add IndexShardOperationPermits.asyncBlockOperations(ActionListener<Releasable>) {es-pull}34902[#34902] (issue: {es-issue}33888[#33888])
* Add a frozen engine implementation {es-pull}34357[#34357] (issue: {es-issue}34352[#34352])

Features::
* Deprecation check for discovery configuration {es-pull}36666[#36666] (issue: {es-issue}36024[#36024])
* Simplify deprecation issue levels {es-pull}36326[#36326]
* Deprecation check for tribe node {es-pull}36240[#36240] (issue: {es-issue}36024[#36024])
* Deprecation check for `:` in Cluster/Index name {es-pull}36185[#36185] (issue: {es-issue}36024[#36024])
* Deprecation check for renamed bulk threadpool settings {es-pull}36662[#36662] (issue: {es-issue}36024[#36024])
* Deprecation check for audit log prefix settings {es-pull}36661[#36661] (issue: {es-issue}36024[#36024])
* Deprecation check for classic similarity {es-pull}36577[#36577] (issue: {es-issue}36024[#36024])
* Deprecation check for HTTP pipelining {es-pull}36521[#36521] (issue: {es-issue}36024[#36024])
* Deprecation check for index threadpool {es-pull}36520[#36520] (issue: {es-issue}36024[#36024])
* Deprecation check for percolator.map_unmapped_fields_as_string {es-pull}36460[#36460] (issue: {es-issue}36024[#36024])
* Deprecation check for http.enabled setting {es-pull}36394[#36394] (issues: {es-issue}29601[#29601], {es-issue}36024[#36024])
* Deprecation check for File Discovery plugin {es-pull}36190[#36190] (issue: {es-issue}36024[#36024])

Geo::
* Adds a name of the field to geopoint parsing errors {es-pull}36529[#36529] (issue: {es-issue}15965[#15965])
* Add support to ShapeBuilders for building Lucene geometry {es-pull}35707[#35707] (issue: {es-issue}35320[#35320])

Ingest::
* Make the ingest-geoip databases even lazier to load {es-pull}36679[#36679]
* ingest: grok fix duplicate patterns JAVACLASS and JAVAFILE  {es-pull}35886[#35886]

Java High Level REST Client::
* Add HLRC support for pause follow API {es-pull}35216[#35216] (issue: {es-issue}33824[#33824])
* Add security Create Token API {es-pull}34791[#34791]
* Add start rollup job support to HL REST Client {es-pull}34623[#34623] (issue: {es-issue}29827[#29827])
* Add security authenticate API {es-pull}33552[#33552]
* Add get users action {es-pull}36332[#36332] (issue: {es-issue}29827[#29827])
* Add delete template API {es-pull}36320[#36320] (issue: {es-issue}27205[#27205])
* Implement get-user-privileges API {es-pull}36292[#36292]
* Get Deprecation Info API {es-pull}36279[#36279] (issue: {es-issue}29827[#29827])
* Added support for Follow Stats API {es-pull}36253[#36253] (issue: {es-issue}33824[#33824])
* Added support for CCR Stats API {es-pull}36213[#36213] (issue: {es-issue}33824[#33824])
* Put Role {es-pull}36209[#36209] (issue: {es-issue}29827[#29827])
* Add index templates exist API {es-pull}36132[#36132] (issue: {es-issue}27205[#27205])
* Add support for CCR Get Auto Follow Pattern apis {es-pull}36049[#36049] (issue: {es-issue}33824[#33824])
* Add support for CCR Delete Auto Follow Pattern API {es-pull}35981[#35981] (issue: {es-issue}33824[#33824])
* Remove fromXContent from IndexUpgradeInfoResponse {es-pull}35934[#35934]
* Add delete expired data API {es-pull}35906[#35906] (issue: {es-issue}29827[#29827])
* Execute watch API {es-pull}35868[#35868] (issue: {es-issue}29827[#29827])
* Add ability to put user with a password hash {es-pull}35844[#35844] (issue: {es-issue}35242[#35242])
* Add ML find file structure API {es-pull}35833[#35833] (issue: {es-issue}29827[#29827])
* Add support for get roles API {es-pull}35787[#35787] (issue: {es-issue}29827[#29827])
* Add support for CCR Put Auto Follow Pattern API {es-pull}35780[#35780] (issue: {es-issue}33824[#33824])
* XPack ML info action {es-pull}35777[#35777] (issue: {es-issue}29827[#29827])
* ML Delete event from Calendar {es-pull}35760[#35760] (issue: {es-issue}29827[#29827])
* Add ML revert model snapshot API {es-pull}35750[#35750] (issue: {es-issue}29827[#29827])
* ML Get Calendar Events {es-pull}35747[#35747] (issue: {es-issue}29827[#29827])
* Add high-level REST client API for `_freeze` and `_unfreeze` {es-pull}35723[#35723] (issue: {es-issue}34352[#34352])
* Fix issue in equals impl for GlobalOperationPrivileges {es-pull}35721[#35721]
* ML Delete job from calendar {es-pull}35713[#35713] (issue: {es-issue}29827[#29827])
* ML Add Event To Calendar API {es-pull}35704[#35704] (issue: {es-issue}29827[#29827])
* Add ML update model snapshot API (#35537) {es-pull}35694[#35694] (issue: {es-issue}29827[#29827])
* Add support for CCR Unfollow API {es-pull}35693[#35693] (issue: {es-issue}33824[#33824])
* Clean up PutLicenseResponse {es-pull}35689[#35689] (issue: {es-issue}35547[#35547])
* Clean up StartBasicResponse {es-pull}35688[#35688] (issue: {es-issue}35547[#35547])
* Add support for put privileges API {es-pull}35679[#35679]
* Add Job to Calendar API {es-pull}35666[#35666] (issue: {es-issue}29827[#29827])
* Add support for CCR Resume Follow API {es-pull}35638[#35638] (issue: {es-issue}33824[#33824])
* Add support for get application privileges API {es-pull}35556[#35556] (issue: {es-issue}29827[#29827])
* Clean up XPackInfoResponse class and related tests {es-pull}35547[#35547]
* Add parameters to stopRollupJob API {es-pull}35545[#35545] (issue: {es-issue}34811[#34811])
* Add ML delete model snapshot API {es-pull}35537[#35537] (issue: {es-issue}29827[#29827])
* Add get watch API {es-pull}35531[#35531] (issue: {es-issue}29827[#29827])
* Add ML Update Filter API {es-pull}35522[#35522] (issue: {es-issue}29827[#29827])
* Add ML get filters api {es-pull}35502[#35502] (issue: {es-issue}29827[#29827])
* Add ML get model snapshots API {es-pull}35487[#35487] (issue: {es-issue}29827[#29827])
* Add "_has_privileges" API to Security Client {es-pull}35479[#35479] (issue: {es-issue}29827[#29827])
* Add Delete Privileges API to HLRC {es-pull}35454[#35454] (issue: {es-issue}29827[#29827])
* Add support for CCR Put Follow API {es-pull}35409[#35409]
* Add ML delete filter action {es-pull}35382[#35382] (issue: {es-issue}29827[#29827])
* Add delete user action {es-pull}35294[#35294] (issue: {es-issue}29827[#29827])
* HLRC for _mtermvectors {es-pull}35266[#35266] (issues: {es-issue}27205[#27205], {es-issue}33447[#33447])
* Reindex API with wait_for_completion false {es-pull}35202[#35202] (issue: {es-issue}27205[#27205])
* Add watcher stats API {es-pull}35185[#35185] (issue: {es-issue}29827[#29827])
* Add ML API PUT filter {es-pull}35175[#35175] (issue: {es-issue}29827[#29827])
* HLRC support for getTask {es-pull}35166[#35166] (issue: {es-issue}27205[#27205])
* Add support for the clear realm cache API {es-pull}35163[#35163] (issue: {es-issue}29827[#29827])
* Add InvalidateToken security API {es-pull}35114[#35114] (issue: {es-issue}29827[#29827])
* Add GetRollupIndexCaps API {es-pull}35102[#35102] (issue: {es-issue}29827[#29827])
* Migration api - upgrade {es-pull}34898[#34898] (issue: {es-issue}29827[#29827])
* Add Update datafeed API {es-pull}34882[#34882] (issue: {es-issue}29827[#29827])
* Add stop rollup job support to HL REST Client {es-pull}34702[#34702] (issue: {es-issue}29827[#29827])
* Bulk Api support for global parameters {es-pull}34528[#34528] (issue: {es-issue}26026[#26026])
* Add support for source exists API {es-pull}34519[#34519] (issue: {es-issue}27205[#27205])
* Add document _count API support to Rest High Level Client. {es-pull}34267[#34267] (issue: {es-issue}27205[#27205])
* Add delete rollup job support to HL REST Client {es-pull}34066[#34066] (issue: {es-issue}29827[#29827])
* HLRC API for _termvectors {es-pull}33447[#33447] (issue: {es-issue}27205[#27205])
* Add support for get license basic/trial status API {es-pull}33176[#33176] (issue: {es-issue}29827[#29827])
* Small corrections to HLRC doc for _termvectors {es-pull}35221[#35221] (issue: {es-issue}33447[#33447])

Java Low Level REST Client::
* On retry timeout add root exception {es-pull}25576[#25576]


Machine Learning::
* Create the {ml} annotations index {es-pull}36731[#36731] (issue: {es-issue}33376[#33376])
* Add cluster setting to enable/disable config migration {es-pull}36700[#36700] (issue: {es-issue}32905[#32905])
* Enable the use of endpoints starting with `_ml` instead of `_xpack/ml` {es-pull}36373[#36373] (issue: {es-issue}36315[#36315])
* Add audits when deprecation warnings occur while datafeeds start {es-pull}36233[#36233]
* Add lazy parsing for DatafeedConfig:Aggs,Query {es-pull}36117[#36117]
* Add support for rollup indexes in datafeeds {es-pull}34654[#34654]

Monitoring::
* Make Exporters Async {es-pull}35765[#35765] (issue: {es-issue}35743[#35743])
* Add cluster metadata to cluster_stats docs (#33860) {es-pull}34023[#34023] (issues: {es-issue}33860[#33860], {es-issue}34040[#34040])

Network::
* Unify transport settings naming {es-pull}36623[#36623]
* Move compression config to ConnectionProfile {es-pull}35357[#35357] (issue: {es-issue}34483[#34483])
* Simplify Transport Compression Setting {es-pull}34959[#34959] (issue: {es-issue}33844[#33844])
* Allow to enable pings for specific remote clusters {es-pull}34753[#34753] (issues: {es-issue}30247[#30247], {es-issue}34405[#34405])

Packaging::
* Introduce Docker images build {es-pull}36246[#36246]
* Move creation of temporary directory to Java {es-pull}36002[#36002] (issue: {es-issue}31003[#31003])
* Update procrun executables to version 1.1.0 {es-pull}35147[#35147]

Plugins::
* Plugin install: don't print download progress in batch mode {es-pull}36361[#36361]

Recovery::
* Exposed engine must include all operations below global checkpoint during rollback {es-pull}36159[#36159] (issue: {es-issue}32867[#32867])
* Use soft-deleted docs to resolve strategy for engine operation {es-pull}35230[#35230] (issues: {es-issue}0[#0], {es-issue}1[#1], {es-issue}33656[#33656], {es-issue}34474[#34474])
* Put a fake allocation id on allocate stale primary command {es-pull}34140[#34140] (issue: {es-issue}33432[#33432])

Rollup::
* Add non-X-Pack centric rollup endpoints {es-pull}36383[#36383] (issues: {es-issue}35958[#35958], {es-issue}35962[#35962])
* Add more diagnostic stats to job {es-pull}35471[#35471]
* Add default fields to job configs {es-pull}34831[#34831]
* Add `wait_for_completion` option to StopRollupJob API {es-pull}34811[#34811] (issue: {es-issue}34574[#34574])

Scripting::
* Update joda compat methods to use compat class {es-pull}36654[#36654]
* [Painless] Add boxed type to boxed type casts for method/return {es-pull}36571[#36571]
* [Painless] Add def to boxed type casts {es-pull}36506[#36506]
* [Scripting] Make Max Script Length Setting Dynamic {es-pull}35184[#35184] (issue: {es-issue}23209[#23209])
* [Painless] Add instance bindings {es-pull}34410[#34410]

Search::
* Use SearchRequest copy constructor in ExpandSearchPhase {es-pull}36772[#36772] (issue: {es-issue}36641[#36641])
* Add copy constructor to SearchRequest {es-pull}36641[#36641] (issue: {es-issue}32125[#32125])
* Add raw sort values to SearchSortValues transport serialization {es-pull}36617[#36617] (issue: {es-issue}32125[#32125])
* Warn when using `use_dis_max` in `multi_match` {es-pull}36614[#36614] (issue: {es-issue}36488[#36488])
* Add sort and collapse info to SearchHits transport serialization {es-pull}36555[#36555] (issue: {es-issue}32125[#32125])
* Add default methods to DocValueFormat {es-pull}36480[#36480]
* Extend field caps API to mark meta fields {es-pull}36309[#36309]
* Respect indices options on _msearch {es-pull}35887[#35887]
* Allow efficient can_match phases on frozen indices {es-pull}35431[#35431] (issues: {es-issue}34352[#34352], {es-issue}34357[#34357])
* Apply `ignore_throttled` also to concrete indices {es-pull}35335[#35335] (issue: {es-issue}34354[#34354])
* Adapt field limit deprecation warning {es-pull}35302[#35302] (issue: {es-issue}35284[#35284])
* Upgrade 6.x to lucene-7.6.0-snapshot-f9598f335b {es-pull}35225[#35225]
* Prevent throttled indices to be searched through wildcards by default {es-pull}34354[#34354] (issues: {es-issue}33732[#33732], {es-issue}34352[#34352])
* check for null argument is already done in splitStringByCommaToArray {es-pull}34268[#34268]
* has_parent builder: exception message/param fix {es-pull}31182[#31182]

Security::
* Option to use endpoints starting with _security {es-pull}36379[#36379] (issue: {es-issue}36293[#36293])
* Make credentials mandatory when launching xpack/migrate {es-pull}36197[#36197] (issues: {es-issue}29847[#29847], {es-issue}33972[#33972])
* Make credentials mandatory when launching x-pack/migrate {es-pull}33972[#33972] (issue: {es-issue}29847[#29847])

Snapshot/Restore::
* Allow Parallel Restore Operations {es-pull}36397[#36397]
* Repo creation out of ClusterStateTask {es-pull}36157[#36157] (issue: {es-issue}9488[#9488])
* Add read-only repository verification {es-pull}35731[#35731] (issue: {es-issue}35703[#35703])

SQL::
* Make `FULL` non-reserved keyword in the grammar {es-pull}37377[#37377] (issue: {es-issue}37376[#37376])
* Extend the ODBC metric by differentiating between 32 and 64bit platforms {es-pull}36753[#36753] (issue: {es-issue}36740[#36740])
* Fix wrong appliance of StackOverflow limit for IN {es-pull}36724[#36724] (issue: {es-issue}36592[#36592])
* Introduce NOW/CURRENT_TIMESTAMP function {es-pull}36562[#36562] (issue: {es-issue}36534[#36534])
* Move requests' parameters to requests JSON body {es-pull}36149[#36149] (issue: {es-issue}35992[#35992])
* Make INTERVAL millis optional {es-pull}36043[#36043] (issue: {es-issue}36032[#36032])
* Implement data type verification for conditionals {es-pull}35916[#35916] (issue: {es-issue}35907[#35907])
* Implement GREATEST and LEAST functions {es-pull}35879[#35879] (issue: {es-issue}35878[#35878])
* Implement null safe equality operator `<=>` {es-pull}35873[#35873] (issue: {es-issue}35871[#35871])
* SYS COLUMNS returns ODBC specific schema {es-pull}35870[#35870] (issue: {es-issue}35376[#35376])
* Polish grammar for intervals {es-pull}35853[#35853]
* Add filtering to SYS TYPES {es-pull}35852[#35852] (issue: {es-issue}35342[#35342])
* Implement NULLIF(expr1, expr2) function {es-pull}35826[#35826] (issue: {es-issue}35818[#35818])
* Lock down JDBC driver {es-pull}35798[#35798] (issue: {es-issue}35437[#35437])
* Implement NVL(expr1, expr2) {es-pull}35794[#35794] (issue: {es-issue}35782[#35782])
* Implement ISNULL(expr1, expr2) {es-pull}35793[#35793] (issue: {es-issue}35781[#35781])
* Implement IFNULL variant of COALESCE {es-pull}35762[#35762] (issue: {es-issue}35749[#35749])
* XPack FeatureSet functionality {es-pull}35725[#35725] (issue: {es-issue}34821[#34821])
* Perform lazy evaluation of mismatched mappings {es-pull}35676[#35676] (issues: {es-issue}35659[#35659], {es-issue}35675[#35675])
* Improve validation of unsupported fields {es-pull}35675[#35675] (issue: {es-issue}35673[#35673])
* Move internals from Joda to java.time {es-pull}35649[#35649] (issue: {es-issue}35633[#35633])
* Improve CircuitBreaker logic for SqlParser {es-pull}35300[#35300] (issue: {es-issue}35299[#35299])
* Upgrade jline to version 3.8.2 {es-pull}35288[#35288]
* New SQL CLI logo {es-pull}35261[#35261]
* Introduce Coalesce function {es-pull}35253[#35253] (issue: {es-issue}35060[#35060])
* Optimizer rule for folding nullable expressions {es-pull}35080[#35080] (issue: {es-issue}34826[#34826])
* Improve painless script generated from `IN` {es-pull}35055[#35055] (issue: {es-issue}34750[#34750])
* Implement CAST between STRING and IP {es-pull}34949[#34949] (issue: {es-issue}34799[#34799])
* Fix function args verification and error msgs {es-pull}34926[#34926] (issues: {es-issue}33469[#33469], {es-issue}34752[#34752])
* Handle X-Pack or X-Pack SQL not being available in a more graceful way {es-pull}34736[#34736] (issue: {es-issue}30009[#30009])

Stats::
* Handle OS pretty name on old OS without OS release {es-pull}35453[#35453] (issue: {es-issue}35440[#35440])
* Add more detailed OS name on Linux {es-pull}35352[#35352]

Task Management::
* Periodically try to reassign unassigned persistent tasks {es-pull}36069[#36069] (issue: {es-issue}35792[#35792])
* Only require task permissions {es-pull}35667[#35667] (issue: {es-issue}35573[#35573])
* Retry if task can't be written {es-pull}35054[#35054] (issue: {es-issue}33764[#33764])


[[bug-6.6.0]]
[float]
=== Bug fixes

Aggregations::
* Fix MultiValuesSourceFieldConfig toXContent {es-pull}36525[#36525] (issue: {es-issue}36474[#36474])
* Cache the score of the parent document in the nested agg {es-pull}36019[#36019] (issues: {es-issue}34555[#34555], {es-issue}35985[#35985])
* Correct implemented interface of ParsedReverseNested {es-pull}35455[#35455] (issue: {es-issue}35449[#35449])
* Handle IndexOrDocValuesQuery in composite aggregation {es-pull}35392[#35392]
* Preserve `format` when aggregation contains unmapped date fields {es-pull}35254[#35254] (issue: {es-issue}31760[#31760])
* Check self references in metric agg after last doc collection (#33593) {es-pull}34001[#34001]

Audit::
* Fix origin.type for connection_* events {es-pull}36410[#36410]
* Fix deprecation of audit log settings {es-pull}36175[#36175] (issue: {es-issue}36162[#36162])
* Fix IndexAuditTrail rolling restart on rollover edge {es-pull}35988[#35988] (issue: {es-issue}33867[#33867])

Authentication::
* Fix NPE in CachingUsernamePasswordRealm {es-pull}36953[#36953] (issue: {es-issue}36951[#36951])
* Add support for Kerberos V5 Oid {es-pull}35764[#35764] (issue: {es-issue}34763[#34763])

Build::
* Use explicit deps on test tasks for check {es-pull}36325[#36325]
* Fix jdbc jar pom to not include deps {es-pull}36036[#36036] (issue: {es-issue}32014[#32014])
* Fix official plugins list {es-pull}35661[#35661] (issue: {es-issue}35623[#35623])

Circuit Breakers::
* Modify `BigArrays` to take name of circuit breaker {es-pull}36461[#36461] (issue: {es-issue}31435[#31435])

Core::
* Revert back to joda's multi date formatters {es-pull}36814[#36814] (issues: {es-issue}36447[#36447], {es-issue}36602[#36602])
* Fix CompositeBytesReference#slice to not throw AIOOBE with legal offsets. {es-pull}35955[#35955] (issue: {es-issue}35950[#35950])
* Suppress CachedTimeThread in hot threads output {es-pull}35558[#35558] (issue: {es-issue}23175[#23175])
* Upgrade to Joda 2.10.1 {es-pull}35410[#35410] (issue: {es-issue}33749[#33749])
* XContent: Check for bad parsers {es-pull}34561[#34561] (issue: {es-issue}34351[#34351])

Cross-cluster replication::
* Add fatal_exception field for ccr stats in monitoring mapping {es-pull}37563[#37563]
* When removing an AutoFollower also mark it as removed. {es-pull}37402[#37402] (issue: {es-issue}36761[#36761])
* Make shard follow tasks more resilient for restarts {es-pull}37239[#37239] (issue: {es-issue}37231[#37231])
* Resume follow Api should not require a request body {es-pull}37217[#37217] (issue: {es-issue}37022[#37022])
* Report error if auto follower tries auto follow a leader index with soft deletes disabled {es-pull}36886[#36886] (issue: {es-issue}33007[#33007])
* Remote cluster license checker and no license info. {es-pull}36837[#36837] (issue: {es-issue}36815[#36815])
* Make CCR resilient against missing remote cluster connections {es-pull}36682[#36682] (issues: {es-issue}36255[#36255], {es-issue}36667[#36667])
* Fix follow stats API's follower index filtering feature {es-pull}36647[#36647]
* AutoFollowCoordinator and follower index already created {es-pull}36540[#36540] (issue: {es-issue}33007[#33007])
* AutoFollowCoordinator should tolerate that auto follow patterns may be removed {es-pull}35945[#35945] (issue: {es-issue}35937[#35937])
* Only auto follow indices when all primary shards have started {es-pull}35814[#35814] (issue: {es-issue}35480[#35480])
* Avoid NPE in follower stats when no tasks metadata {es-pull}35802[#35802]
* Fix the names of CCR stats endpoints in usage API {es-pull}35438[#35438]

CRUD::
* Synchronize WriteReplicaResult callbacks {es-pull}36770[#36770]
* Fix DeleteRequest validation for nullable or empty id/type {es-pull}35314[#35314] (issue: {es-issue}35297[#35297])
* Fix UpdateRequest.fromXContent {es-pull}35257[#35257] (issues: {es-issue}29293[#29293], {es-issue}34069[#34069])

Distributed::
* Combine the execution of an exclusive replica operation with primary term update {es-pull}36116[#36116] (issue: {es-issue}35850[#35850])
* ActiveShardCount should not fail when closing the index {es-pull}35936[#35936]

Engine::
* Wrap can_match reader with ElasticsearchDirectoryReader {es-pull}35857[#35857]
* Copy checkpoint atomically when rolling generation {es-pull}35407[#35407]

Features::
* Handle Null in FetchSourceContext#fetchSource {es-pull}36839[#36839] (issue: {es-issue}29293[#29293])

Geo::
* More robust handling of ignore_malformed in geoshape parsing {es-pull}35603[#35603] (issues: {es-issue}34047[#34047], {es-issue}34498[#34498])
* Better handling of malformed geo_points {es-pull}35554[#35554] (issue: {es-issue}35419[#35419])
* Enables coerce support in WKT polygon parser {es-pull}35414[#35414] (issue: {es-issue}35059[#35059])
* Further improve robustness of geo shape parser for malformed shapes {es-pull}34498[#34498] (issues: {es-issue}31449[#31449], {es-issue}34047[#34047])

Index lifecycle management::
* Remove `indexing_complete` when removing policy {es-pull}36620[#36620]

Index APIs::
* Fix duplicate phrase in shrink/split error message {es-pull}36734[#36734] (issue: {es-issue}36729[#36729])
* Make XContentBuilder in AliasActions build `is_write_index` field {es-pull}35071[#35071]
* Raise a 404 exception when document source is not found (#33384) {es-pull}34083[#34083] (issue: {es-issue}33384[#33384])

Ingest::
* Fix on_failure with Drop processor {es-pull}36686[#36686] (issue: {es-issue}36151[#36151])
* Support default pipelines + bulk upserts {es-pull}36618[#36618] (issue: {es-issue}36219[#36219])
* Support default pipeline through an alias {es-pull}36231[#36231] (issue: {es-issue}35817[#35817])
* Dot_expander_processor prevent null add/append to source document {es-pull}35106[#35106]

Machine Learning::
* Fix cause of "Sample out of bounds" error message. {ml-pull}335[#335]
* Fix hang when closing a job or creating a forecast. This problem occurs if you created a forecast for a large job and temporary storage was not cleaned up.  {ml-pull}352[#352] (issue: {ml-issue}350[#350])
* Wait for autodetect to be ready in the datafeed {es-pull}37349[#37349] (issues: {es-issue}36810[#36810], {es-issue}37227[#37227])
* Stop datafeeds when their jobs are stale {es-pull}37227[#37227] (issue: {es-issue}36810[#36810])
* Order get job stats API response by job id {es-pull}36841[#36841] (issue: {es-issue}36683[#36683])

Mapping::
* Make sure to accept empty unnested mappings in create index requests. {es-pull}37089[#37089]

Monitoring::
* Add missing error type mapping for apm-server {es-pull}36178[#36178] (issue: {es-issue}1614[#1614])

Network::
* Do not resolve addresses in remote connection info {es-pull}36671[#36671] (issue: {es-issue}35658[#35658])
* Always compress based on the settings {es-pull}36522[#36522] (issue: {es-issue}36399[#36399])
* http.publish_host should contain CNAME {es-pull}32806[#32806] (issue: {es-issue}22029[#22029])

Packaging::
* Fix error message when package install fails due to missing Java {es-pull}36077[#36077] (issue: {es-issue}31845[#31845])
* Add missing entries to conffiles  {es-pull}35810[#35810] (issue: {es-issue}35691[#35691])

Ranking::
* QueryRescorer should keep the window size when rewriting {es-pull}36836[#36836]
* Fix a bug in function_score queries where we use the wrong boost_mode. {es-pull}35148[#35148] (issue: {es-issue}35123[#35123])

Recovery::
* Register ResyncTask.Status as a NamedWriteable {es-pull}36610[#36610]

Rollup::
* Fix Rollup's metadata parser {es-pull}36791[#36791] (issue: {es-issue}36726[#36726])
* Fix rollup search statistics {es-pull}36674[#36674]
* Improve handling of failures on first search {es-pull}35269[#35269]
* Proactively resolve index patterns in RollupSearch endoint {es-pull}34930[#34930] (issue: {es-issue}34828[#34828])

Scripting::
* Properly support no-offset date formatting {es-pull}36316[#36316] (issue: {es-issue}36306[#36306])
* [Painless] Generate Bridge Methods {es-pull}36097[#36097]
* Fix serialization bug in painless execute api request {es-pull}36075[#36075] (issue: {es-issue}36050[#36050])
* Actually add joda time back to whitelist {es-pull}35965[#35965] (issue: {es-issue}35915[#35915])
* Add back joda to whitelist {es-pull}35915[#35915] (issue: {es-issue}35913[#35913])
* [Painless] Partially fixes def boxed types casting {es-pull}35563[#35563] (issue: {es-issue}35351[#35351])
* Add back lookup vars in score script {es-pull}34833[#34833]

Search::
* Inner hits fail to propagate doc-value format. (#36310) {es-pull}36355[#36355] (issue: {es-issue}36310[#36310])
* Fix custom AUTO issue with Fuzziness#toXContent {es-pull}35807[#35807] (issue: {es-issue}33462[#33462])
* Fix analyzed prefix query in query_string {es-pull}35756[#35756] (issue: {es-issue}31702[#31702])
* Fix problem with MatchNoDocsQuery in disjunction queries {es-pull}35726[#35726] (issue: {es-issue}34708[#34708])
* Fix phrase_slop in query_string query {es-pull}35533[#35533] (issue: {es-issue}35125[#35125])
* Add a More Like This query routing requirement check (#29678) {es-pull}33974[#33974]

Security::
* Remove license state listeners on closables {es-pull}36308[#36308] (issues: {es-issue}33328[#33328], {es-issue}35627[#35627], {es-issue}35628[#35628])

Settings::
* Fix setting by time unit {es-pull}37192[#37192]
* Fix handling of fractional byte size value settings {es-pull}37172[#37172]
* Fix handling of fractional time value settings {es-pull}37171[#37171]
* Correctly Identify Noop Updates {es-pull}36560[#36560] (issue: {es-issue}36496[#36496])

Snapshot/Restore::
* Improve Resilience SnapshotShardService {es-pull}36113[#36113] (issue: {es-issue}32265[#32265])
* Register Azure max_retries setting {es-pull}35286[#35286]
* Restore Should Check Min. Version {es-pull}34676[#34676] (issue: {es-issue}34264[#34264])

SQL::
* Fix issue with field names containing "." {es-pull}37364[#37364] (issue: {es-issue}37128[#37128])
* Proper handling of COUNT(field_name) and COUNT(DISTINCT field_name) {es-pull}37254[#37254] (issue: {es-issue}30285[#30285])
* Fix COUNT DISTINCT filtering {es-pull}37176[#37176] (issue: {es-issue}37086[#37086])
* Fix issue with wrong NULL optimization {es-pull}37124[#37124] (issue: {es-issue}35872[#35872])
* Count distinct doesn't recognize that a string field has a keyword version {es-pull}37176[#37176] (issue: {es-issue}37087[#37087])
* Handle the bwc Joda ZonedDateTime scripting class in Painless {es-pull}37024[#37024] (issue: {es-issue}37023[#37023])
* Fix bug regarding histograms usage in scripting {es-pull}36866[#36866]
* Fix issue with always false filter involving functions {es-pull}36830[#36830] (issue: {es-issue}35980[#35980])
* Protocol returns ISO 8601 String formatted dates instead of Long for JDBC/ODBC requests {es-pull}36800[#36800] (issue: {es-issue}36756[#36756])
* Fix translation of LIKE/RLIKE keywords {es-pull}36672[#36672] (issues: {es-issue}36039[#36039], {es-issue}36584[#36584])
* Scripting support for casting functions CAST and CONVERT {es-pull}36640[#36640] (issue: {es-issue}36061[#36061])
* Fix translation to painless for conditionals {es-pull}36636[#36636] (issue: {es-issue}36631[#36631])
* Concat should be always not nullable {es-pull}36601[#36601] (issue: {es-issue}36169[#36169])
* Fix MOD() for long and integer arguments {es-pull}36599[#36599] (issue: {es-issue}36364[#36364])
* Fix issue with complex HAVING and GROUP BY ordinal {es-pull}36594[#36594] (issue: {es-issue}36059[#36059])
* Be lenient for tests involving comparison to H2 but strict for csv spec tests {es-pull}36498[#36498] (issue: {es-issue}36483[#36483])
* Non ISO 8601 versions of DAY_OF_WEEK and WEEK_OF_YEAR functions {es-pull}36358[#36358] (issue: {es-issue}36263[#36263])
* Do not ignore all fields whose names start with underscore {es-pull}36214[#36214] (issue: {es-issue}36206[#36206])
* SUM() and LIKE condition doesn't work anymore {es-pull}36672[#36672] (issue: {es-issue}36161[#36161])
* Fix issue with wrong data type for scripted Grouping keys {es-pull}35969[#35969] (issue: {es-issue}35662[#35662])
* Fix translation of math functions to painless {es-pull}35910[#35910] (issue: {es-issue}35654[#35654])
* Build: Fix jdbc jar to include deps {es-pull}35602[#35602]
* Fix query translation for scripted queries {es-pull}35408[#35408] (issue: {es-issue}35232[#35232])
* Clear the cursor if nested inner hits are enough to fulfill the query required limits {es-pull}35398[#35398] (issue: {es-issue}35176[#35176])
* Fix null handling for AND and OR in SELECT {es-pull}35277[#35277] (issue: {es-issue}35240[#35240])
* Handle null literal for AND and OR in `WHERE` {es-pull}35236[#35236] (issue: {es-issue}35088[#35088])
* Introduce NotEquals node to simplify expressions {es-pull}35234[#35234] (issues: {es-issue}35210[#35210], {es-issue}35233[#35233])
* Introduce IsNull node to simplify expressions {es-pull}35206[#35206] (issues: {es-issue}34876[#34876], {es-issue}35171[#35171])
* Handle wildcard expansion on incorrect fields {es-pull}35134[#35134] (issue: {es-issue}35092[#35092])
* Fix null handling for IN => painless script {es-pull}35124[#35124] (issues: {es-issue}35108[#35108], {es-issue}35122[#35122])
* Register missing processors {es-pull}35121[#35121] (issue: {es-issue}35119[#35119])
* Fix NPE thrown if HAVING filter evals to null {es-pull}35108[#35108] (issue: {es-issue}35107[#35107])
* Proper handling of nested fields at the beginning of the columns list {es-pull}35068[#35068] (issue: {es-issue}32951[#32951])
* Fix incorrect AVG data type {es-pull}34948[#34948] (issue: {es-issue}33773[#33773])
* Add `CAST` and `CONVERT` to `SHOW FUNCTIONS` {es-pull}34940[#34940] (issue: {es-issue}34939[#34939])
* Handle aggregation for null group {es-pull}34916[#34916] (issue: {es-issue}34896[#34896])
* Provide null-safe scripts for Not and Neg {es-pull}34877[#34877] (issue: {es-issue}34848[#34848])
* Return error with ORDER BY on non-grouped. {es-pull}34855[#34855] (issue: {es-issue}34590[#34590])
* Fix negation of equals comparison. {es-pull}34680[#34680] (issue: {es-issue}34558[#34558])
* CAST doesn't work in ORDER BY. {es-pull}36640[#36640] (issue: {es-issue}34557[#34557])
* COUNT(column) takes into account NULLs {es-pull}37254[#37254] (issue: {es-issue}34549[#34549])

Watcher::
* Watcher accounts constructed lazily {es-pull}36656[#36656]
* Only trigger a watch if new or schedule/changed {es-pull}35908[#35908]
* Fix Watcher NotificationService's secure settings {es-pull}35610[#35610] (issue: {es-issue}35378[#35378])
* Fix integration tests to ensure correct start/stop of Watcher {es-pull}35271[#35271] (issues: {es-issue}29877[#29877], {es-issue}30705[#30705], {es-issue}33291[#33291], {es-issue}34448[#34448], {es-issue}34462[#34462])


[[regression-6.6.0]]
[float]
=== Regressions

Scripting::
* Use Number as a return value for BucketAggregationScript {es-pull}35653[#35653] (issue: {es-issue}35351[#35351])


[[upgrade-6.6.0]]
[float]
=== Upgrades

Network::
* Upgrade Netty 4.3.32.Final {es-pull}36102[#36102] (issue: {es-issue}35360[#35360])
