[[release-notes-6.7.2]]
== {es} version 6.7.2

Also see <<breaking-changes-6.7,Breaking changes in 6.7>>.

[[enhancement-6.7.2]]
[float]
=== Enhancements

CCR::
* Reduce security permissions in CCR plugin {es-pull}41391[#41391]

Distributed::
* Avoid background sync on relocated primary {es-pull}40800[#40800] (issue: {es-issue}40731[#40731])

Infra/Packaging::
* Be lenient when parsing build flavor and type on the wire {es-pull}40734[#40734] (issues: {es-issue}39378[#39378], {es-issue}40723[#40723])

Machine Learning::
* [ML] Allow xpack.ml.max_machine_memory_percent higher than 100% {es-pull}41193[#41193]

Snapshot/Restore::
* Mark Deleted Snapshot Directories with Tombstones {es-pull}40228[#40228] (issue: {es-issue}39852[#39852])



[[bug-6.7.2]]
[float]
=== Bug fixes

Allocation::
* Short-circuit rebalancing when disabled {es-pull}40966[#40966] (issue: {es-issue}40942[#40942])

Authorization::
* Fix role mapping DN field wildcards for users with NULL DNs {es-pull}41343[#41343] (issue: {es-issue}41305[#41305])
* Fix Has Privilege API check on restricted indices {es-pull}41226[#41226]
* put mapping authorization for alias with write-index and multiple read indices {es-pull}40834[#40834] (issue: {es-issue}40831[#40831])
* Use alias name from rollover request to query indices stats {es-pull}40774[#40774] (issue: {es-issue}40771[#40771])

CCR::
* Suppress lease background sync failures if stopping {es-pull}40902[#40902]

Distributed::
* Fix NPE on Stale Index in IndicesService {es-pull}38891[#38891] (issue: {es-issue}38845[#38845])

Features/ILM::
* Allow ILM to stop if indices have nonexistent policies {es-pull}40820[#40820] (issue: {es-issue}40824[#40824])

Features/Monitoring::
* Properly handle Monitoring exporters all disabled {es-pull}40920[#40920] (issue: {es-issue}40919[#40919])

Features/Watcher::
* Use setIfSeqNo(...) and setIfPrimaryTerm(...) for updating watch status if all nodes are at least on 6.7.0 {es-pull}40888[#40888] (issue: {es-issue}40841[#40841])

Highlighting::
* Unified highlighter should ignore terms that target the _id field {es-pull}41275[#41275] (issue: {es-issue}37525[#37525])
* Unified highlighter should respect no_match_size with number_of_fragments set to 0 {es-pull}41069[#41069] (issue: {es-issue}41066[#41066])

Infra/Core::
* Allow single digit milliseconds in strict date parsing {es-pull}40676[#40676] (issue: {es-issue}40403[#40403])
* Bat scripts to work with JAVA_HOME with parantheses {es-pull}39712[#39712] (issues: {es-issue}30606[#30606], {es-issue}33405[#33405], {es-issue}38578[#38578], {es-issue}38624[#38624])

Infra/Packaging::
* Suppress illegal access in plugin install {es-pull}41620[#41620] (issue: {es-issue}41478[#41478])

Infra/Scripting::
* Correct bug in ScriptDocValues {es-pull}40864[#40864] (issue: {es-issue}40488[#40488])
* Correct bug in ScriptDocValues {es-pull}40488[#40488]

Infra/Settings::
* Always check for archiving broken index settings {es-pull}41209[#41209]

Machine Learning::
* [ML] checking if p-tasks metadata is null before updating state {es-pull}41091[#41091] (issue: {es-issue}41090[#41090])
* [ML] Write header to autodetect before it is visible to other calls {es-pull}41085[#41085] (issue: {es-issue}40385[#40385])
* Fix unsafe publication of invalid license enforcer {es-pull}40985[#40985] (issue: {es-issue}40957[#40957])
* [ML] Scrolling datafeed should clear scroll contexts on error {es-pull}40773[#40773] (issue: {es-issue}40772[#40772])

Mapping::
* Optimise rejection of out-of-range `long` values {es-pull}40325[#40325] (issues: {es-issue}26137[#26137], {es-issue}40323[#40323])

Recovery::
* Resync should not send operations without sequence number {es-pull}40433[#40433]

Rollup::
* Remove timezone validation on rollup range queries {es-pull}40647[#40647]

SQL::
* SQL: Fix bug with optimization of null related conditionals {es-pull}41355[#41355]
* SQL: Predicate diff takes into account all values {es-pull}41346[#41346] (issue: {es-issue}40835[#40835])
* SQL: Fix LIMIT bug in agg sorting {es-pull}41258[#41258] (issue: {es-issue}40984[#40984])
* SQL: Allow current_date/time/timestamp to be also used as a function escape pattern {es-pull}41254[#41254] (issue: {es-issue}41240[#41240])
* SQL: Translate MIN/MAX on keyword fields as FIRST/LAST {es-pull}41247[#41247] (issues: {es-issue}37936[#37936], {es-issue}41195[#41195])
* SQL: Tweak pattern matching in SYS TABLES {es-pull}41243[#41243] (issue: {es-issue}40775[#40775])
* SQL: Change schema calls to empty set {es-pull}41034[#41034] (issue: {es-issue}41028[#41028])
* SQL: Fix display size for DATE/DATETIME {es-pull}40669[#40669]
* SQL: Use ResultSets over exceptions in metadata {es-pull}40641[#40641] (issue: {es-issue}40533[#40533])
* SQL: Fix catalog filtering in SYS COLUMNS {es-pull}40583[#40583] (issue: {es-issue}40582[#40582])

Search::
* Full text queries should not always ignore unmapped fields {es-pull}41062[#41062] (issue: {es-issue}41022[#41022])
* Fix rewrite of inner queries in DisMaxQueryBuilder {es-pull}40956[#40956] (issue: {es-issue}40953[#40953])
* Fix alias resolution runtime complexity. {es-pull}40263[#40263] (issue: {es-issue}40248[#40248])

Security::
* Fix unsafe publication in opt-out query cache {es-pull}40957[#40957]
* Remove dynamic objects from security index {es-pull}40499[#40499] (issue: {es-issue}35460[#35460])

Snapshot/Restore::
* Fix Broken Index Shard Snapshot File Preventing Snapshot Creation {es-pull}41310[#41310] (issue: {es-issue}41304[#41304])
* Do not create missing directories in readonly repo {es-pull}41249[#41249] (issues: {es-issue}26909[#26909], {es-issue}41009[#41009])



[[upgrade-6.7.2]]
[float]
=== Upgrades

Infra/Packaging::
* Bump the bundled JDK to 12.0.1 {es-pull}41627[#41627]

[[release-notes-6.7.1]]
== {es} version 6.7.1


Also see <<breaking-changes-6.7,Breaking changes in 6.7>>.

[[enhancement-6.7.1]]
[float]
=== Enhancements

Infra/Core::
* Enhancements to IndicesQueryCache. {es-pull}39099[#39099] (issue: {es-issue}37117[#37117])

SQL::
* SQL: add "fuzziness" option to QUERY and MATCH function predicates {es-pull}40529[#40529] (issue: {es-issue}40495[#40495])



[[bug-6.7.1]]
[float]
=== Bug fixes

Authentication::
* Allow non super users to create API keys {es-pull}40028[#40028] (issue: {es-issue}40029[#40029])

CCR::
* Only run retention lease actions on active primary {es-pull}40386[#40386] (issues: {es-issue}40089[#40089], {es-issue}40373[#40373])

CRUD::
* Store Pending Deletions Fix {es-pull}40345[#40345] (issue: {es-issue}40249[#40249])

Features/ILM::
* Correct ILM metadata minimum compatibility version {es-pull}40569[#40569] (issue: {es-issue}40565[#40565])
* Handle null retention leases in WaitForNoFollowersStep {es-pull}40477[#40477]

Geo::
* Geo Point parse error fix {es-pull}40447[#40447] (issue: {es-issue}17617[#17617])

Infra/Core::
* Parse composite patterns using ClassicFormat.parseObject {es-pull}40100[#40100] (issue: {es-issue}39916[#39916])

Infra/Packaging::
* Use TAR instead of DOCKER build type before 6.7.0 {es-pull}40723[#40723] (issues: {es-issue}39378[#39378], {es-issue}40511[#40511])

Machine Learning::
* [ML] Addressing bug streaming DatafeedConfig aggs from (<= 6.5.4) -> 6.7.0 {es-pull}40610[#40610]

SQL::
* SQL: have LIKE/RLIKE use wildcard and regexp queries {es-pull}40628[#40628] (issue: {es-issue}40557[#40557])
* SQL: Fix getTime() methods in JDBC {es-pull}40484[#40484]
* SQL: Add missing handling of IP field in JDBC {es-pull}40384[#40384] (issue: {es-issue}40358[#40358])
* SQL: Fix metric aggs on date/time to not return double {es-pull}40377[#40377] (issues: {es-issue}39492[#39492], {es-issue}40376[#40376])
* SQL: CAST supports both SQL and ES types {es-pull}40365[#40365] (issue: {es-issue}40282[#40282])
* SQL: Fix RLIKE bug and improve testing for RLIKE statement {es-pull}40354[#40354] (issues: {es-issue}34609[#34609], {es-issue}39931[#39931])
* SQL: SYS TABLES: enumerate tables of requested types [ISSUE] {es-pull}40348[#40348]
* SQL: JLine upgrade and polishing {es-pull}40321[#40321] (issue: {es-issue}40239[#40239])
* SQL: unwrap the first value in an array in case of array leniency {es-pull}40318[#40318] (issue: {es-issue}40296[#40296])
* SQL: fix LIKE function equality by considering its pattern as well {es-pull}40260[#40260] (issue: {es-issue}39931[#39931])
* SQL: rewrite ROUND and TRUNCATE functions with a different optional parameter handling method {es-pull}40242[#40242] (issue: {es-issue}40001[#40001])
* SQL: passing an input to the CLI "freezes" the CLI after displaying an error message [ISSUE] {es-pull}40164[#40164]

[[release-notes-6.7.0]]
== {es} version 6.7.0

Also see <<breaking-changes-6.7,Breaking changes in 6.7>>.

[float]
=== Known issues

A new `docker` `build_type` value was introduced in 6.7.0 for Docker images,
which caused two problems:

* If you perform a rolling upgrade to 6.7.0 on nodes that are running the
official Docker container, they cannot rejoin the cluster. Upgrade to 6.7.1
instead or perform a <<restart-upgrade,full cluster restart upgrade>>.
(issue: {es-issue}/40784[#40784])
* If you have a 6.6 or earlier Java High Level REST client, it cannot understand
the new `build_type` value. For example, it cannot read main responses on `/`
from a cluster that's running 6.7.0. Upgrade your client to 6.7.0 or later.
(issue: {es-issue}/40511[#40511])

Features/ILM::
If an index is configured with an `index.lifecycle.name` that refers to a policy
that does not exist, when <<start-stop-ilm, {ilm} is stopped>>, {ilm}'s status
will remain as `STOPPING` until all policies that do not exist are removed from
any indices by using the <<ilm-remove-policy,Remove Policy API>>.
(issue: {es-issue}/40824[#40824])

[[breaking-6.7.0]]
[float]
=== Breaking changes

Authentication::
* The TokenService no longer accepts tokens generated by Elasticsearch 6.1 or earlier {es-pull}38881[#38881]

CCR::
* Follow stats api should return a 404 when requesting stats for a non existing index {es-pull}37220[#37220] (issue: {es-issue}37021[#37021])

Distributed::
* Stop returning cluster state size by default {es-pull}40016[#40016] (issues: {es-issue}39806[#39806], {es-issue}39827[#39827], {es-issue}39951[#39951])

Infra/Packaging::
* Package ingest-user-agent as a module {es-pull}36956[#36956]
* Package ingest-geoip as a module {es-pull}36898[#36898]

Ranking::
* Forbid negative field boosts in analyzed queries {es-pull}37930[#37930] (issue: {es-issue}33309[#33309])



[[breaking-java-6.7.0]]
[float]
=== Breaking Java changes

Infra/Core::
* Handle scheduler exceptions {es-pull}38014[#38014] (issues: {es-issue}28667[#28667], {es-issue}36137[#36137], {es-issue}37708[#37708])



[[deprecation-6.7.0]]
[float]
=== Deprecations

Analysis::
* [Analysis] Deprecate standard html analyzer in 6.x {es-pull}37292[#37292] (issues: {es-issue}26719[#26719], {es-issue}4704[#4704])

Audit::
* Deprecate index audit output type {es-pull}37671[#37671] (issues: {es-issue}29881[#29881], {es-issue}37301[#37301])
* Deprecate index audit output type {es-pull}37301[#37301] (issue: {es-issue}29881[#29881])

CRUD::
* Deprecate support for internal versioning for concurrency control {es-pull}38451[#38451] (issues: {es-issue}10708[#10708], {es-issue}38254[#38254])

Cluster Coordination::
* Deprecate size in cluster state response {es-pull}39951[#39951] (issue: {es-issue}39806[#39806])

Features/Features::
* Deprecate Migration Assistance and Upgrade APIs  {es-pull}40072[#40072] (issue: {es-issue}40014[#40014])

Features/Java High Level REST Client::
* Deprecate HLRC EmptyResponse used by security {es-pull}37540[#37540] (issue: {es-issue}36938[#36938])

Features/Java Low Level REST Client::
* Deprecate the low-level REST client on JDK 7 {es-pull}38542[#38542] (issue: {es-issue}29607[#29607])
* Deprecate maxRetryTimeout in RestClient and increase default value {es-pull}38425[#38425] (issue: {es-issue}38085[#38085])

Features/Watcher::
* Deprecate Hipchat Watcher actions {es-pull}39160[#39160]

Infra/Core::
* Core: Deprecate negative epoch timestamps {es-pull}36793[#36793]

Infra/Packaging::
* Deprecate fallback to java on PATH {es-pull}37990[#37990]

Infra/REST API::
* Deprecate requests that have an unconsumed body {es-pull}37534[#37534] (issue: {es-issue}37504[#37504])

Machine Learning::
* Add ml_settings entry to HLRC and Docs for deprecation_info {es-pull}38118[#38118]
* Datafeed deprecation checks {es-pull}37932[#37932]
* Adjust structure finder for Joda to Java time migration {es-pull}37306[#37306]

Mapping::
* Deprecate types in get field mapping API {es-pull}37667[#37667] (issue: {es-issue}35190[#35190])
*  Deprecate types in the put mapping API. {es-pull}37280[#37280] (issues: {es-issue}29453[#29453], {es-issue}37285[#37285])
* Support include_type_name in the field mapping and index template APIs. {es-pull}37210[#37210]
* Deprecate types in create index requests. {es-pull}37134[#37134] (issues: {es-issue}29453[#29453], {es-issue}37285[#37285])

Network::
* Add TLS version changes to deprecation checks {es-pull}37793[#37793] (issue: {es-issue}37512[#37512])
* Issue deprecation warning if TLSv1.0 is used without explicit config {es-pull}37788[#37788] (issue: {es-issue}37512[#37512])
* Add deprecation warnings for ssl config fallback {es-pull}36847[#36847] (issue: {es-issue}36846[#36846])

Security::
* Deprecate implicit security on trial licenses {es-pull}38295[#38295] (issues: {es-issue}38009[#38009], {es-issue}38075[#38075])



[[feature-6.7.0]]
[float]
=== New features

Authentication::
* Add support for API keys to access Elasticsearch {es-pull}38291[#38291] (issue: {es-issue}34383[#34383])

Authorization::
* Allow custom authorization with an authorization engine  {es-pull}38358[#38358] (issues: {es-issue}32435[#32435], {es-issue}36245[#36245], {es-issue}37328[#37328], {es-issue}37495[#37495], {es-issue}37785[#37785], {es-issue}38137[#38137], {es-issue}38219[#38219])
* WIldcard IndicesPermissions don't cover .security {es-pull}36765[#36765]

CCR::
* Add ccr follow info api {es-pull}37408[#37408] (issue: {es-issue}37127[#37127])

CRUD::
* Make `_doc` work as an alias of the actual type of an index. {es-pull}39505[#39505] (issue: {es-issue}39469[#39469])

Features/ILM::
* [ILM] Add unfollow action {es-pull}36970[#36970] (issue: {es-issue}34648[#34648])

Features/Ingest::
* Enable grok processor to support long, double and boolean {es-pull}27896[#27896]

Machine Learning::
* Add set_upgrade_mode API endpoint {es-pull}37837[#37837]

Mapping::
* Give precedence to index creation when mixing typed templates with typeless index creation and vice-versa. {es-pull}37871[#37871] (issue: {es-issue}37773[#37773])
* Add an `include_type_name` option to 6.x. (#29453) {es-pull}37147[#37147] (issue: {es-issue}35190[#35190])

SQL::
* SQL: Allow sorting of groups by aggregates {es-pull}38042[#38042] (issue: {es-issue}35118[#35118])
* SQL: Implement FIRST/LAST aggregate functions {es-pull}37936[#37936] (issue: {es-issue}35639[#35639])
* SQL: Introduce SQL DATE data type {es-pull}37693[#37693] (issue: {es-issue}37340[#37340])

Security::
* Switch internal security index to ".security-7" {es-pull}39337[#39337] (issue: {es-issue}39284[#39284])



[[enhancement-6.7.0]]
[float]
=== Enhancements

Aggregations::
* Add Composite to AggregationBuilders {es-pull}38207[#38207] (issue: {es-issue}38020[#38020])
* Allow nested fields in the composite aggregation {es-pull}37178[#37178] (issue: {es-issue}28611[#28611])
* Remove single shard optimization when suggesting shard_size {es-pull}37041[#37041] (issue: {es-issue}32125[#32125])
* Use List instead of priority queue for stable sorting in bucket sort aggregator {es-pull}36748[#36748] (issue: {es-issue}36322[#36322])
* Keys are compared in BucketSortPipelineAggregation so making key type… {es-pull}36407[#36407]

Audit::
* Security Audit includes HTTP method for requests {es-pull}37322[#37322] (issue: {es-issue}29765[#29765])
* Add X-Forwarded-For to the logfile audit {es-pull}36427[#36427]

Authentication::
* Security: propagate auth result to listeners {es-pull}36900[#36900] (issue: {es-issue}30794[#30794])
* Security: reorder realms based on last success {es-pull}36878[#36878]
* Deprecation check for Auth realm setting structure {es-pull}36664[#36664] (issue: {es-issue}36024[#36024])

Authorization::
* Permission for restricted indices {es-pull}37577[#37577] (issue: {es-issue}34454[#34454])
* Create snapshot role {es-pull}35820[#35820] (issue: {es-issue}34454[#34454])

CCR::
* Reduce retention lease sync intervals {es-pull}40302[#40302]
* Introduce forget follower API {es-pull}39718[#39718] (issue: {es-issue}37165[#37165])
* Renew retention leases while following {es-pull}39335[#39335] (issues: {es-issue}37165[#37165], {es-issue}38718[#38718])
* Reduce refresh when lookup term in FollowingEngine {es-pull}39184[#39184]
* Integrate retention leases to recovery from remote {es-pull}38829[#38829] (issue: {es-issue}37165[#37165])
* Enable removal of retention leases {es-pull}38751[#38751] (issue: {es-issue}37165[#37165])
* Concurrent file chunk fetching for CCR restore {es-pull}38495[#38495]
* Tighten mapping syncing in ccr remote restore {es-pull}38071[#38071] (issues: {es-issue}36879[#36879], {es-issue}37887[#37887])
* Do not allow put mapping on follower {es-pull}37675[#37675] (issue: {es-issue}30086[#30086])
* Added ccr to xpack usage infrastructure {es-pull}37256[#37256] (issue: {es-issue}37221[#37221])
* [CCR] FollowingEngine should fail with 403 if operation has no seqno assigned {es-pull}37213[#37213]
* [CCR] Added auto_follow_exception.timestamp field to auto follow stats {es-pull}36947[#36947]

CRUD::
* Add Seq# based optimistic concurrency control to UpdateRequest {es-pull}37872[#37872] (issues: {es-issue}10708[#10708], {es-issue}36148[#36148])
* Introduce ssl settings to reindex from remote {es-pull}37527[#37527] (issues: {es-issue}29755[#29755], {es-issue}37287[#37287])
* Use Sequence number powered OCC for processing updates {es-pull}37308[#37308] (issues: {es-issue}10708[#10708], {es-issue}36148[#36148])
* Document Seq No powered optimistic concurrency control {es-pull}37284[#37284] (issues: {es-issue}10708[#10708], {es-issue}36148[#36148])
* Enable IPv6 URIs in reindex from remote {es-pull}36874[#36874]
* Set acking timeout to 0 on dynamic mapping update {es-pull}31140[#31140] (issues: {es-issue}30672[#30672], {es-issue}30844[#30844])

Client::
* Fixed required fields and paths list {es-pull}39358[#39358]

Cluster Coordination::
* Expose minimum_master_nodes in cluster state {es-pull}37811[#37811] (issue: {es-issue}37701[#37701])

Distributed::
* Add BWC for retention leases {es-pull}39482[#39482] (issue: {es-issue}37165[#37165])
* Allow retention lease operations under blocks {es-pull}39089[#39089] (issues: {es-issue}34648[#34648], {es-issue}37165[#37165])
* Remove retention leases when unfollowing {es-pull}39088[#39088] (issues: {es-issue}34648[#34648], {es-issue}37165[#37165])
* Introduce retention lease state file {es-pull}39004[#39004] (issues: {es-issue}37165[#37165], {es-issue}38588[#38588], {es-issue}39032[#39032])
* Introduce retention lease actions {es-pull}38756[#38756] (issue: {es-issue}37165[#37165])
* Add dedicated retention lease exceptions {es-pull}38754[#38754] (issue: {es-issue}37165[#37165])
* Recover retention leases during peer recovery {es-pull}38435[#38435] (issue: {es-issue}37165[#37165])
* Lift retention lease expiration to index shard {es-pull}38380[#38380] (issues: {es-issue}37165[#37165], {es-issue}37963[#37963], {es-issue}38070[#38070])
* Introduce retention lease background sync {es-pull}38262[#38262] (issue: {es-issue}37165[#37165])
* Copy retention leases when trim unsafe commits {es-pull}37995[#37995] (issue: {es-issue}37165[#37165])
* Expose retention leases in shard stats {es-pull}37991[#37991] (issue: {es-issue}37165[#37165])
* Introduce retention leases versioning {es-pull}37951[#37951] (issue: {es-issue}37165[#37165])
* Soft-deletes policy should always fetch latest leases {es-pull}37940[#37940] (issues: {es-issue}37165[#37165], {es-issue}37375[#37375])
* Sync retention leases on expiration {es-pull}37902[#37902] (issue: {es-issue}37165[#37165])
* Ignore shard started requests when primary term does not match {es-pull}37899[#37899] (issue: {es-issue}33888[#33888])
* Move update and delete by query to use seq# for optimistic concurrency control {es-pull}37857[#37857] (issues: {es-issue}10708[#10708], {es-issue}36148[#36148], {es-issue}37639[#37639])
* Introduce retention lease serialization {es-pull}37447[#37447] (issues: {es-issue}37165[#37165], {es-issue}37398[#37398])
* Add run under primary permit method {es-pull}37440[#37440] (issue: {es-issue}37398[#37398])
* Introduce retention lease syncing {es-pull}37398[#37398] (issue: {es-issue}37165[#37165])
* Introduce retention lease persistence {es-pull}37375[#37375] (issue: {es-issue}37165[#37165])
* Add validation for retention lease construction {es-pull}37312[#37312] (issue: {es-issue}37165[#37165])
* Introduce retention lease expiration {es-pull}37195[#37195] (issue: {es-issue}37165[#37165])
* Introduce shard history retention leases {es-pull}37167[#37167] (issue: {es-issue}37165[#37165])
* Always initialize the global checkpoint {es-pull}34381[#34381]

Docs Infrastructure::
* Align generated release notes with doc standards {es-pull}39234[#39234] (issue: {es-issue}39155[#39155])

Engine::
* Also mmap cfs files for hybridfs {es-pull}38940[#38940] (issue: {es-issue}36668[#36668])
* Specialize pre-closing checks for engine implementations {es-pull}38702[#38702]
* Ensure that max seq # is equal to the global checkpoint when creating ReadOnlyEngines {es-pull}37426[#37426]
* Enable Bulk-Merge if all source remains {es-pull}37269[#37269]
* Introduce time-based retention policy for soft-deletes {es-pull}34943[#34943] (issue: {es-issue}34908[#34908])

Features/CAT APIs::
* Expose `search.throttled` on `_cat/indices` {es-pull}37073[#37073] (issue: {es-issue}34352[#34352])

Features/Features::
* Deprecation check for No Master Block setting {es-pull}38383[#38383] (issue: {es-issue}36024[#36024])
* Run Node deprecation checks locally {es-pull}38065[#38065] (issue: {es-issue}37845[#37845])
* Watcher notification settings Upgrade checks {es-pull}36907[#36907]

Features/ILM::
* Ensure ILM policies run safely on leader indices  {es-pull}38140[#38140] (issue: {es-issue}34648[#34648])
* Skip Shrink when numberOfShards not changed {es-pull}37953[#37953] (issue: {es-issue}33275[#33275])
* Inject Unfollow before Rollover and Shrink {es-pull}37625[#37625] (issue: {es-issue}34648[#34648])
* Add set_priority action to ILM {es-pull}37397[#37397] (issue: {es-issue}36905[#36905])
* [ILM] Add Freeze Action {es-pull}36910[#36910] (issue: {es-issue}34630[#34630])

Features/Indices APIs::
* New mapping signature and mapping string source fixed. {es-pull}37401[#37401]

Features/Ingest::
* minor updates for user-agent ecs for 6.7 {es-pull}39213[#39213] (issue: {es-issue}38757[#38757])
* Dep. check for ECS changes to User Agent processor {es-pull}38362[#38362] (issue: {es-issue}36024[#36024])
* Add ECS schema for user-agent ingest processor {es-pull}37727[#37727] (issue: {es-issue}37329[#37329])
* ingest: compile mustache template only if field includes '{{'' {es-pull}37207[#37207] (issue: {es-issue}37120[#37120])
* Move ingest-geoip default databases out of config {es-pull}36949[#36949] (issue: {es-issue}36898[#36898])

Features/Java High Level REST Client::
* HLRC: Fix strict setting exception handling {es-pull}37247[#37247] (issue: {es-issue}37090[#37090])
* HLRC: Use nonblocking entity for requests {es-pull}32249[#32249]

Features/Watcher::
* Move watcher to use seq# and primary term for concurrency control {es-pull}37977[#37977] (issues: {es-issue}10708[#10708], {es-issue}37872[#37872])

Infra/Core::
* Use DateFormatter in monitoring instead of joda code {es-pull}38309[#38309]
* Use dateformatter in ingest-common to log deprecations {es-pull}38099[#38099]
* Add simple method to write collection of writeables {es-pull}37448[#37448] (issue: {es-issue}37398[#37398])
* Date/Time parsing: Use java time API instead of exception handling {es-pull}37222[#37222]
* [API] spelling: interruptible {es-pull}37049[#37049] (issue: {es-issue}37035[#37035])
* restrict node start-up when cluster name in data path {es-pull}36519[#36519] (issue: {es-issue}32661[#32661])

Infra/Logging::
* Trim the JSON source in indexing slow logs {es-pull}38081[#38081] (issue: {es-issue}38080[#38080])
* Optimize warning header de-duplication {es-pull}37725[#37725] (issues: {es-issue}35754[#35754], {es-issue}37530[#37530], {es-issue}37597[#37597], {es-issue}37622[#37622])
* Remove warn-date from warning headers {es-pull}37622[#37622] (issues: {es-issue}35754[#35754], {es-issue}37530[#37530], {es-issue}37597[#37597])
* Add some deprecation optimizations {es-pull}37597[#37597] (issues: {es-issue}35754[#35754], {es-issue}37530[#37530])
* Only update response headers if we have a new one {es-pull}37590[#37590] (issues: {es-issue}35754[#35754], {es-issue}37530[#37530])

Infra/Packaging::
* Upgrade bundled JDK and Docker images to JDK 12 {es-pull}40229[#40229]
* Change file descriptor limit to 65535 {es-pull}37537[#37537] (issue: {es-issue}35839[#35839])
* Exit batch files explictly using ERRORLEVEL {es-pull}29583[#29583] (issue: {es-issue}29582[#29582])

Infra/Scripting::
* Add getZone to JodaCompatibleZonedDateTime {es-pull}37084[#37084]

Infra/Settings::
* Provide a clearer error message on keystore add {es-pull}39327[#39327] (issue: {es-issue}39324[#39324])
* Separate out validation of groups of settings {es-pull}34184[#34184]

License::
* Handle malformed license signatures {es-pull}37137[#37137] (issue: {es-issue}35340[#35340])

Machine Learning::
* Allow stop unassigned datafeed and relax unset upgrade mode wait {es-pull}39034[#39034]
* Move ML Optimistic Concurrency Control to Seq No {es-pull}38278[#38278] (issues: {es-issue}10708[#10708], {es-issue}36148[#36148])
* Add upgrade mode docs, hlrc, and fix bug {es-pull}37942[#37942]
* Tighten up use of aliases rather than concrete indices {es-pull}37874[#37874]
* Add support for single bucket aggs in Datafeeds {es-pull}37544[#37544] (issue: {es-issue}36838[#36838])
* Migrate unallocated jobs and datafeeds {es-pull}37536[#37536] (issue: {es-issue}32905[#32905])
* Adjust seccomp filter for Fedora 29. {ml-pull}354[#354]

Mapping::
* Only issue a deprecation warning if include_type_name is not set. {es-pull}38825[#38825] (issue: {es-issue}35190[#35190])
* Log document id when MapperParsingException occurs {es-pull}37800[#37800] (issue: {es-issue}37658[#37658])
* Types removal - add constants for include_type_names {es-pull}37304[#37304]
* Deprecation check for index_options on numeric fields {es-pull}37026[#37026] (issue: {es-issue}36024[#36024])
* Deprecation check for indices with multiple types {es-pull}36952[#36952] (issues: {es-issue}35190[#35190], {es-issue}36024[#36024])
* Use index-prefix fields for terms of length min_chars - 1 {es-pull}36703[#36703]

Recovery::
* Do not wait for advancement of checkpoint in recovery {es-pull}39006[#39006] (issues: {es-issue}38949[#38949], {es-issue}39000[#39000])
* SyncedFlushService.getShardRoutingTable() should use metadata to check for index existence {es-pull}37691[#37691] (issue: {es-issue}33888[#33888])
* Make prepare engine step of recovery source non-blocking {es-pull}37573[#37573] (issue: {es-issue}37174[#37174])
* Make recovery source send operations non-blocking {es-pull}37503[#37503] (issue: {es-issue}37458[#37458])
* Prepare to make send translog of recovery non-blocking {es-pull}37458[#37458] (issue: {es-issue}37291[#37291])
* Make finalize step of recovery source non-blocking {es-pull}37388[#37388] (issue: {es-issue}37291[#37291])
* Make recovery source partially non-blocking {es-pull}37291[#37291] (issue: {es-issue}36195[#36195])
* Do not mutate RecoveryResponse {es-pull}37204[#37204] (issue: {es-issue}37174[#37174])
* Don't block on peer recovery on the target side {es-pull}37076[#37076] (issue: {es-issue}36195[#36195])
* Reduce recovery time with compress or secure transport {es-pull}36981[#36981] (issue: {es-issue}33844[#33844])

Rollup::
* Replace the TreeMap in the composite aggregation {es-pull}36675[#36675]

SQL::
* SQL: Enhance checks for inexact fields {es-pull}39427[#39427] (issue: {es-issue}38501[#38501])
* SQL: change the default precision for CURRENT_TIMESTAMP function {es-pull}39391[#39391] (issue: {es-issue}39288[#39288])
* SQL: add "validate.properties" property to JDBC's allowed list of settings {es-pull}39050[#39050] (issue: {es-issue}38068[#38068])
* SQL: Allow look-ahead resolution of aliases for WHERE clause {es-pull}38450[#38450] (issue: {es-issue}29983[#29983])
* SQL: Implement CURRENT_DATE {es-pull}38175[#38175] (issue: {es-issue}38160[#38160])
* SQL: Generate relevant error message when grouping functions are not used in GROUP BY {es-pull}38017[#38017] (issue: {es-issue}37952[#37952])
* SQL: Skip the nested and object field types in case of an ODBC request {es-pull}37948[#37948] (issue: {es-issue}37801[#37801])
* SQL: Add protocol tests and remove jdbc_type from drivers response {es-pull}37516[#37516] (issues: {es-issue}36635[#36635], {es-issue}36882[#36882])
* SQL: Remove slightly used meta commands {es-pull}37506[#37506] (issue: {es-issue}37409[#37409])
* SQL: Describe aliases as views {es-pull}37496[#37496] (issue: {es-issue}37422[#37422])
* SQL: Make `FULL` non-reserved keyword in the grammar {es-pull}37377[#37377] (issue: {es-issue}37376[#37376])
* SQL: Use declared source for error messages {es-pull}37161[#37161]
* SQL: Improve error message when unable to translate to ES query DSL {es-pull}37129[#37129] (issue: {es-issue}37040[#37040])
* [API] spelling: subtract {es-pull}37055[#37055] (issue: {es-issue}37035[#37035])
* [API] spelling: similar {es-pull}37054[#37054] (issue: {es-issue}37035[#37035])
* [API] spelling: input {es-pull}37048[#37048] (issue: {es-issue}37035[#37035])
* SQL: Enhance message for PERCENTILE[_RANK] with field as 2nd arg {es-pull}36933[#36933] (issue: {es-issue}36903[#36903])
* SQL: Preserve original source for each expression {es-pull}36912[#36912] (issue: {es-issue}36894[#36894])

Search::
* Add finalReduce flag to SearchRequest {es-pull}38104[#38104] (issues: {es-issue}37000[#37000], {es-issue}37838[#37838])
* Expose sequence number and primary terms in search responses {es-pull}37639[#37639]
* Allow field types to optimize phrase prefix queries {es-pull}37436[#37436] (issue: {es-issue}31921[#31921])
* Add support for providing absolute start time to SearchRequest {es-pull}37142[#37142] (issue: {es-issue}32125[#32125])
* Ensure that local cluster alias is never treated as remote {es-pull}37121[#37121] (issues: {es-issue}32125[#32125], {es-issue}36997[#36997])
* [API] spelling: cacheable {es-pull}37047[#37047] (issue: {es-issue}37035[#37035])
* Add ability to suggest shard_size on coord node rewrite {es-pull}37017[#37017] (issues: {es-issue}32125[#32125], {es-issue}36997[#36997], {es-issue}37000[#37000])
* Skip final reduction if SearchRequest holds a cluster alias {es-pull}37000[#37000] (issues: {es-issue}32125[#32125], {es-issue}36997[#36997])
* Add support for local cluster alias to SearchRequest {es-pull}36997[#36997] (issue: {es-issue}32125[#32125])

Security::
* Move CAS operations in TokenService to sequence numbers {es-pull}38311[#38311] (issues: {es-issue}10708[#10708], {es-issue}37872[#37872])
* Cleanup construction of interceptors {es-pull}38294[#38294]

Snapshot/Restore::
* RestoreService should update primary terms when restoring shards of existing indices {es-pull}38177[#38177] (issue: {es-issue}33888[#33888])
* Allow open indices to be restored {es-pull}37733[#37733]
* Create specific exception for when snapshots are in progress {es-pull}37550[#37550] (issue: {es-issue}37541[#37541])
* SNAPSHOT: Speed up HDFS Repository Writes {es-pull}37069[#37069]
* Implement Atomic Blob Writes for HDFS Repository {es-pull}37066[#37066] (issue: {es-issue}37011[#37011])
* [API] spelling: repositories {es-pull}37053[#37053] (issue: {es-issue}37035[#37035])
* SNAPSHOT: Use CancellableThreads to Abort {es-pull}35901[#35901] (issue: {es-issue}21759[#21759])

Suggesters::
* [API] spelling: likelihood {es-pull}37052[#37052] (issue: {es-issue}37035[#37035])



[[bug-6.7.0]]
[float]
=== Bug fixes

Aggregations::
* Skip sibling pipeline aggregators reduction during non-final reduce {es-pull}40101[#40101] (issue: {es-issue}40059[#40059])
* Only create MatrixStatsResults on final reduction {es-pull}38130[#38130] (issue: {es-issue}37587[#37587])
* Don't load global ordinals with the `map` execution_hint {es-pull}37833[#37833] (issue: {es-issue}37705[#37705])
* Issue #37303 - Invalid variance fix {es-pull}37384[#37384] (issue: {es-issue}37303[#37303])

Allocation::
* Fix _host based require filters {es-pull}38173[#38173]
* Ignore obsolete dangling indices {es-pull}37824[#37824] (issue: {es-issue}27073[#27073])
* ALLOC: Fail Stale Primary Alloc. Req. without Data {es-pull}37226[#37226] (issue: {es-issue}37098[#37098])

Analysis::
* Fix PreConfiguredTokenFilters getSynonymFilter() implementations {es-pull}38858[#38858] (issues: {es-issue}38793[#38793], {es-issue}38839[#38839])
* Fix PreConfiguredTokenFilters getSynonymFilter() implementations {es-pull}38839[#38839] (issue: {es-issue}38793[#38793])

Audit::
* LoggingAuditTrail correctly handle ReplicatedWriteRequest {es-pull}39925[#39925] (issue: {es-issue}39555[#39555])
* Fix IndexAuditTrail rolling upgrade on rollover edge - take 2 {es-pull}38286[#38286] (issues: {es-issue}33867[#33867], {es-issue}35988[#35988], {es-issue}37062[#37062])
* Fix NPE in Logfile Audit Filter {es-pull}38120[#38120] (issue: {es-issue}38097[#38097])

Authentication::
* Correct authenticate response for API key {es-pull}39684[#39684]
* Fix security index auto-create and state recovery race {es-pull}39582[#39582]
* Use consistent view of realms for authentication {es-pull}38815[#38815] (issue: {es-issue}30301[#30301])
*  Enhance parsing of StatusCode in SAML Responses {es-pull}38628[#38628]
* Limit token expiry to 1 hour maximum {es-pull}38244[#38244]
* Fix expired token message in Exception header {es-pull}37196[#37196]
* Fix NPE in CachingUsernamePasswordRealm {es-pull}36953[#36953] (issue: {es-issue}36951[#36951])

CCR::
* Safe publication of AutoFollowCoordinator {es-pull}40153[#40153] (issue: {es-issue}38560[#38560])
* Enable reading auto-follow patterns from x-content {es-pull}40130[#40130] (issue: {es-issue}40128[#40128])
* Stop auto-followers on shutdown {es-pull}40124[#40124]
* Protect against the leader index being removed {es-pull}39351[#39351] (issue: {es-issue}39308[#39308])
* Fix shard follow task startup error handling {es-pull}39053[#39053] (issue: {es-issue}38779[#38779])
* Filter out upgraded version index settings when starting index following {es-pull}38838[#38838] (issue: {es-issue}38835[#38835])
* Handle the fact that `ShardStats` instance may have no commit or seqno stats {es-pull}38782[#38782] (issue: {es-issue}38779[#38779])
* Fix LocalIndexFollowingIT#testRemoveRemoteConnection() test {es-pull}38709[#38709] (issue: {es-issue}38695[#38695])
* Prevent CCR recovery from missing documents {es-pull}38237[#38237]
* Fix file reading in ccr restore service {es-pull}38117[#38117]
* Correct argument names in update mapping/settings from leader {es-pull}38063[#38063]
* Ensure changes requests return the latest mapping version {es-pull}37633[#37633]
* Do not set fatal exception when shard follow task is stopped. {es-pull}37603[#37603]
* Add fatal_exception field for ccr stats in monitoring mapping {es-pull}37563[#37563]
* Do not add index event listener if CCR disabled {es-pull}37432[#37432]
* When removing an AutoFollower also mark it as removed. {es-pull}37402[#37402] (issue: {es-issue}36761[#36761])
* [CCR] Resume follow Api should not require a request body {es-pull}37217[#37217] (issue: {es-issue}37022[#37022])

CRUD::
* Cascading primary failure lead to MSU too low {es-pull}40249[#40249]
* ShardBulkAction ignore primary response on primary {es-pull}38901[#38901]
* Fix Reindex from remote query logic {es-pull}36908[#36908]

Cluster Coordination::
* Fixing the custom object serialization bug in diffable utils. {es-pull}39544[#39544]
* Always return metadata version if metadata is requested {es-pull}37674[#37674]

Distributed::
* Enforce retention leases require soft deletes {es-pull}39922[#39922] (issue: {es-issue}39914[#39914])
* Treat TransportService stopped error as node is closing {es-pull}39800[#39800] (issue: {es-issue}39584[#39584])
* Use cause to determine if node with primary is closing {es-pull}39723[#39723] (issue: {es-issue}39584[#39584])
* Don’t ack if unable to remove failing replica {es-pull}39584[#39584] (issue: {es-issue}39467[#39467])
* Ignore waitForActiveShards when syncing leases {es-pull}39224[#39224] (issue: {es-issue}39089[#39089])
* Fix synchronization in LocalCheckpointTracker#contains {es-pull}38755[#38755] (issues: {es-issue}33871[#33871], {es-issue}38633[#38633])
* TransportVerifyShardBeforeCloseAction should force a flush {es-pull}38401[#38401] (issues: {es-issue}33888[#33888], {es-issue}37961[#37961])
* Fix limit on retaining sequence number {es-pull}37992[#37992] (issue: {es-issue}37165[#37165])
* Close Index API should force a flush if a sync is needed {es-pull}37961[#37961] (issues: {es-issue}33888[#33888], {es-issue}37426[#37426])
* Force Refresh Listeners when Acquiring all Operation Permits {es-pull}36835[#36835]
* Replaced the word 'shards' with 'replicas' in an error message. (#36234) {es-pull}36275[#36275] (issue: {es-issue}36234[#36234])

Engine::
* Bubble up exception when processing NoOp {es-pull}39338[#39338] (issue: {es-issue}38898[#38898])
* ReadOnlyEngine should update translog recovery state information {es-pull}39238[#39238]
* Advance max_seq_no before add operation to Lucene {es-pull}38879[#38879] (issue: {es-issue}31629[#31629])

Features/Features::
* Only count some fields types for deprecation check {es-pull}40166[#40166]
* Deprecation check for indices with very large numbers of fields {es-pull}39869[#39869] (issue: {es-issue}39851[#39851])
* Check for .watches that wasn't upgraded properly {es-pull}39609[#39609]
* Link to 7.0 documentation in deprecation checks {es-pull}39194[#39194]
* Handle Null in FetchSourceContext#fetchSource {es-pull}36839[#36839] (issue: {es-issue}29293[#29293])

Features/ILM::
* Handle failure to release retention leases in ILM {es-pull}39281[#39281] (issue: {es-issue}39181[#39181])
* Preserve ILM operation mode when creating new lifecycles {es-pull}38134[#38134] (issues: {es-issue}38229[#38229], {es-issue}38230[#38230])
* Retry ILM steps that fail due to SnapshotInProgressException {es-pull}37624[#37624] (issues: {es-issue}37541[#37541], {es-issue}37552[#37552])
* Remove `indexing_complete` when removing policy {es-pull}36620[#36620]

Features/Indices APIs::
* Add pre-upgrade check to test cluster routing allocation is enabled {es-pull}39340[#39340] (issue: {es-issue}39339[#39339])
* Reject delete index requests with a body {es-pull}37501[#37501] (issue: {es-issue}8217[#8217])
* Get Aliases with wildcard exclusion expression {es-pull}34230[#34230] (issues: {es-issue}33518[#33518], {es-issue}33805[#33805], {es-issue}34144[#34144])

Features/Ingest::
* Ingest ingest then create index {es-pull}39607[#39607] (issues: {es-issue}32758[#32758], {es-issue}32786[#32786], {es-issue}36545[#36545])
* Support unknown fields in ingest pipeline map configuration {es-pull}38352[#38352] (issue: {es-issue}36938[#36938])
* Ingest node - user_agent, move device parsing to an object {es-pull}38115[#38115] (issues: {es-issue}37329[#37329], {es-issue}38094[#38094])

Features/Java High Level REST Client::
* Allow setting of `copy_settings` in the HLRC {es-pull}39752[#39752] (issue: {es-issue}30255[#30255])
* Update IndexTemplateMetaData to allow unknown fields {es-pull}38448[#38448] (issue: {es-issue}36938[#36938])
* `if_seq_no` and `if_primary_term` parameters aren't wired correctly in REST Client's CRUD API {es-pull}38411[#38411]
* Update Rollup Caps to allow unknown fields {es-pull}38339[#38339] (issue: {es-issue}36938[#36938])
* Fix ILM explain response to allow unknown fields {es-pull}38054[#38054] (issue: {es-issue}36938[#36938])
* Fix ILM status to allow unknown fields {es-pull}38043[#38043] (issue: {es-issue}36938[#36938])
* Fix ILM Lifecycle Policy to allow unknown fields {es-pull}38041[#38041] (issue: {es-issue}36938[#36938])
* Update authenticate to allow unknown fields {es-pull}37713[#37713] (issue: {es-issue}36938[#36938])
* Update verify repository to allow unknown fields {es-pull}37619[#37619] (issue: {es-issue}36938[#36938])
* Update get users to allow unknown fields {es-pull}37593[#37593] (issue: {es-issue}36938[#36938])
* Update Execute Watch to allow unknown fields {es-pull}37498[#37498] (issue: {es-issue}36938[#36938])
* Update Put Watch to allow unknown fields {es-pull}37494[#37494] (issue: {es-issue}36938[#36938])
* Update Delete Watch to allow unknown fields {es-pull}37435[#37435] (issue: {es-issue}36938[#36938])
* Fix weighted_avg parser not found for RestHighLevelClient {es-pull}37027[#37027] (issue: {es-issue}36861[#36861])

Features/Monitoring::
* Specify include_type_name in HTTP monitoring. {es-pull}38927[#38927] (issue: {es-issue}37442[#37442])
* Allow built-in monitoring_user role to call GET _xpack API {es-pull}38060[#38060] (issue: {es-issue}37970[#37970])

Features/Watcher::
* Fix Watcher stats class cast exception {es-pull}39821[#39821] (issue: {es-issue}39780[#39780])
* Use any index specified by .watches for Watcher {es-pull}39541[#39541] (issue: {es-issue}39478[#39478])
* Resolve concurrency with watcher trigger service {es-pull}39092[#39092] (issue: {es-issue}39087[#39087])
* Only flush Watcher's bulk processor if Watcher is enabled {es-pull}38803[#38803] (issue: {es-issue}38798[#38798])

Geo::
* Geo: Do not normalize the longitude with value -180 for Lucene shapes {es-pull}37299[#37299] (issue: {es-issue}37297[#37297])

Highlighting::
* Bug fix for AnnotatedTextHighlighter {es-pull}39525[#39525] (issue: {es-issue}39395[#39395])

Infra/Core::
* Correct name of basic_date_time_no_millis {es-pull}39367[#39367]
* Fix DateFormatters.parseMillis when no timezone is given {es-pull}39100[#39100] (issue: {es-issue}39067[#39067])
* Prefix java formatter patterns with '8' {es-pull}38712[#38712] (issue: {es-issue}38567[#38567])
* Bubble-up exceptions from scheduler {es-pull}38317[#38317] (issue: {es-issue}38014[#38014])
* Core: Revert back to joda's multi date formatters {es-pull}36814[#36814] (issues: {es-issue}36447[#36447], {es-issue}36602[#36602])
* Propagate Errors in executors to uncaught exception handler {es-pull}36137[#36137] (issue: {es-issue}28667[#28667])

Infra/Packaging::
* Remove NOREPLACE for /etc/elasticsearch in rpm and deb {es-pull}37839[#37839]
* Packaging: Remove permission editing in postinst {es-pull}37242[#37242] (issue: {es-issue}37143[#37143])
* Suppress error message when `/proc/sys/vm/max_map_count` is not exists. {es-pull}35933[#35933]

Infra/Scripting::
* Fix Painless void return bug {es-pull}38046[#38046]

Infra/Settings::
* Fix setting by time unit {es-pull}37192[#37192]
* Fix handling of fractional byte size value settings {es-pull}37172[#37172]
* Fix handling of fractional time value settings {es-pull}37171[#37171]

Machine Learning::
* Fix race condition when creating multiple jobs {es-pull}40049[#40049] (issue: {es-issue}38785[#38785])
* Fix datafeed skipping first bucket after lookback when aggs are used {es-pull}39859[#39859] (issue: {es-issue}39842[#39842])
* Refactoring lazy query and agg parsing {es-pull}39776[#39776] (issue: {es-issue}39528[#39528])
* Allow aliased .ml-anomalies* index on PUT Job {es-pull}38821[#38821] (issue: {es-issue}38773[#38773])
* Report index unavailable instead of waiting for lazy node {es-pull}38423[#38423]
* Prevent submit after autodetect worker is stopped {es-pull}37700[#37700] (issue: {es-issue}37108[#37108])
* Fix ML datafeed CCS with wildcarded cluster name {es-pull}37470[#37470] (issue: {es-issue}36228[#36228])
* Update error message for process update {es-pull}37363[#37363]
* Make GetJobStats work with arbitrary wildcards and groups {es-pull}36683[#36683] (issue: {es-issue}34745[#34745])

Mapping::
* Make sure to reject mappings with type _doc when include_type_name is false. {es-pull}38270[#38270] (issue: {es-issue}38266[#38266])
* Treat put-mapping calls with `_doc` as a top-level key as typed calls. {es-pull}38032[#38032]
* Update the deprecation message for typed put mapping requests. {es-pull}37835[#37835]
* Make sure PutMappingRequest accepts content types other than JSON. {es-pull}37720[#37720]
* MAPPING: Improve Precision for scaled_float {es-pull}37169[#37169] (issue: {es-issue}32570[#32570])
* Make sure to accept empty unnested mappings in create index requests. {es-pull}37089[#37089]
* Stop automatically nesting mappings in index creation requests. {es-pull}36924[#36924]

Network::
* Rebuild remote connections on profile changes {es-pull}37678[#37678] (issue: {es-issue}37201[#37201])
* Reload SSL context on file change for LDAP {es-pull}36937[#36937] (issues: {es-issue}30509[#30509], {es-issue}36923[#36923])

Ranking::
* QueryRescorer should keep the window size when rewriting {es-pull}36836[#36836]

Recovery::
* Create retention leases file during recovery {es-pull}39359[#39359] (issue: {es-issue}37165[#37165])
* RecoveryMonitor#lastSeenAccessTime should be volatile {es-pull}36781[#36781]

SQL::
* SQL: Preserve original source for cast/convert function {es-pull}40271[#40271] (issue: {es-issue}40239[#40239])
* SQL: Fix issue with optimization on queries with ORDER BY/LIMIT {es-pull}40256[#40256] (issue: {es-issue}40211[#40211])
* SQL: Fix issue with getting DATE type in JDBC {es-pull}40207[#40207]
* SQL: Fix issue with date columns returned always in UTC {es-pull}40163[#40163] (issue: {es-issue}40152[#40152])
* SQL: Add multi_value_field_leniency inside FieldHitExtractor {es-pull}40113[#40113] (issue: {es-issue}39700[#39700])
* SQL: fix incorrect ordering of groupings (GROUP BY) based on orderings (ORDER BY) {es-pull}40087[#40087] (issue: {es-issue}39956[#39956])
* SQL: Fix bug with JDBC timezone setting and DATE type {es-pull}39978[#39978] (issue: {es-issue}39915[#39915])
* SQL: Wrap ZonedDateTime parameters inside scripts {es-pull}39911[#39911] (issue: {es-issue}39877[#39877])
* SQL: ConstantProcessor can now handle NamedWriteable {es-pull}39876[#39876] (issue: {es-issue}39875[#39875])
* SQL: Extend the multi dot field notation extraction to lists of values {es-pull}39823[#39823] (issue: {es-issue}39738[#39738])
* SQL: values in datetime script aggs should be treated as long {es-pull}39773[#39773] (issue: {es-issue}37042[#37042])
* SQL: Don't allow inexact fields for MIN/MAX {es-pull}39563[#39563] (issue: {es-issue}39427[#39427])
* SQL: Fix merging of incompatible multi-fields {es-pull}39560[#39560] (issue: {es-issue}39547[#39547])
* SQL: fix COUNT DISTINCT column name {es-pull}39537[#39537] (issue: {es-issue}39511[#39511])
* SQL: ignore UNSUPPORTED fields for JDBC and ODBC modes in 'SYS COLUMNS' {es-pull}39518[#39518] (issue: {es-issue}39471[#39471])
* SQL: Use underlying exact field for LIKE/RLIKE {es-pull}39443[#39443] (issue: {es-issue}39442[#39442])
* SQL: enforce JDBC driver - ES server version parity {es-pull}38972[#38972] (issue: {es-issue}38775[#38775])
* SQL: fall back to using the field name for column label {es-pull}38842[#38842] (issue: {es-issue}38831[#38831])
* SQL: Prevent grouping over grouping functions {es-pull}38649[#38649] (issue: {es-issue}38308[#38308])
* SQL: Relax StackOverflow circuit breaker for constants {es-pull}38572[#38572] (issue: {es-issue}38571[#38571])
* SQL: Fix issue with IN not resolving to underlying keyword field {es-pull}38440[#38440] (issue: {es-issue}38424[#38424])
* SQL: change the Intervals milliseconds precision to 3 digits {es-pull}38297[#38297] (issue: {es-issue}37423[#37423])
* SQL: Fix esType for DATETIME/DATE and INTERVALS {es-pull}38179[#38179] (issue: {es-issue}38051[#38051])
* SQL: Added SSL configuration options tests {es-pull}37875[#37875] (issue: {es-issue}37711[#37711])
* SQL: Fix casting from date to numeric type to use millis {es-pull}37869[#37869] (issue: {es-issue}37655[#37655])
* SQL: Fix BasicFormatter NPE {es-pull}37804[#37804]
* SQL: Return Intervals in SQL format for CLI {es-pull}37602[#37602] (issues: {es-issue}29970[#29970], {es-issue}36186[#36186], {es-issue}36432[#36432])
* SQL: fix object extraction from sources {es-pull}37502[#37502] (issue: {es-issue}37364[#37364])
* SQL: Fix issue with field names containing "." {es-pull}37364[#37364] (issue: {es-issue}37128[#37128])
* SQL: Fix bug regarding alias fields with dots {es-pull}37279[#37279] (issue: {es-issue}37224[#37224])
* SQL: Proper handling of COUNT(field_name) and COUNT(DISTINCT field_name) {es-pull}37254[#37254] (issue: {es-issue}30285[#30285])
* SQL: fix COUNT DISTINCT filtering {es-pull}37176[#37176] (issue: {es-issue}37086[#37086])
* SQL: Fix issue with wrong NULL optimization {es-pull}37124[#37124] (issue: {es-issue}35872[#35872])
* SQL: Fix issue with complex expression as args of PERCENTILE/_RANK {es-pull}37102[#37102] (issue: {es-issue}37099[#37099])
* SQL: Handle the bwc Joda ZonedDateTime scripting class in Painless {es-pull}37024[#37024] (issue: {es-issue}37023[#37023])
* SQL: Fix bug regarding histograms usage in scripting {es-pull}36866[#36866]
* SQL: Fix issue with always false filter involving functions {es-pull}36830[#36830] (issue: {es-issue}35980[#35980])
* SQL: protocol returns ISO 8601 String formatted dates instead of Long for JDBC/ODBC requests {es-pull}36800[#36800] (issue: {es-issue}36756[#36756])
* SQL: Enhance Verifier to prevent aggregate or grouping functions from {es-pull}36799[#36799] (issue: {es-issue}36798[#36798])
* SQL: normalized keywords shouldn't be allowed for groupings and sorting [ISSUE] {es-pull}35203[#35203]

Search::
* Serialize top-level pipeline aggs as part of InternalAggregations {es-pull}40177[#40177] (issues: {es-issue}40059[#40059], {es-issue}40101[#40101])
* Fix Fuzziness#asDistance(String) {es-pull}39643[#39643] (issue: {es-issue}39614[#39614])
* Fix simple query string serialization conditional {es-pull}38960[#38960] (issues: {es-issue}21504[#21504], {es-issue}38889[#38889])
* Ensure that maxConcurrentShardRequests is never defaulted to 0 {es-pull}38734[#38734]
* Look up connection using the right cluster alias when releasing contexts {es-pull}38570[#38570]
* Fix fetch source option in expand search phase {es-pull}37908[#37908] (issue: {es-issue}23829[#23829])
* Throw if two inner_hits have the same name {es-pull}37645[#37645] (issue: {es-issue}37584[#37584])
* Ensure either success or failure path for SearchOperationListener is called {es-pull}37467[#37467] (issue: {es-issue}37185[#37185])
* Use executor `SAME` to handle search related handlers {es-pull}37427[#37427] (issues: {es-issue}33732[#33732], {es-issue}37392[#37392])

Security::
* Fix exit code for Security CLI tools  {es-pull}37956[#37956] (issue: {es-issue}37841[#37841])
* Fix potential NPE in UsersTool {es-pull}37660[#37660]

Snapshot/Restore::
* Fix Concurrent Snapshot Ending And Stabilize Snapshot Finalization {es-pull}38368[#38368] (issue: {es-issue}38226[#38226])
* Fix Two Races that Lead to Stuck Snapshots {es-pull}37686[#37686] (issues: {es-issue}32265[#32265], {es-issue}32348[#32348])
* Fix Race in Concurrent Snapshot Delete and Create {es-pull}37612[#37612] (issue: {es-issue}37581[#37581])
* Streamline S3 Repository- and Client-Settings {es-pull}37393[#37393]
* SNAPSHOTS: Upgrade GCS Dependencies to 1.55.0 {es-pull}36634[#36634] (issues: {es-issue}35229[#35229], {es-issue}35459[#35459])

Suggesters::
* Fix duplicate removal when merging completion suggestions {es-pull}36996[#36996] (issue: {es-issue}35836[#35836])

Task Management::
* Un-assign persistent tasks as nodes exit the cluster {es-pull}37656[#37656]



[[regression-6.7.0]]
[float]
=== Regressions

Infra/Core::
* Speed up converting of temporal accessor to zoned date time {es-pull}37915[#37915] (issue: {es-issue}37826[#37826])



[[upgrade-6.7.0]]
[float]
=== Upgrades

Discovery-Plugins::
* Bump jackson-databind version for AWS SDK {es-pull}39183[#39183]

Features/Ingest::
* Bump jackson-databind version for ingest-geoip {es-pull}39182[#39182]

Security::
* Upgrade the bouncycastle dependency to 1.61 {es-pull}40017[#40017] (issue: {es-issue}40011[#40011])

Snapshot/Restore::
* plugins/repository-gcs: Update google-cloud-storage/core to 1.59.0 {es-pull}39748[#39748] (issue: {es-issue}39366[#39366])
